/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2024 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"
#include "cmsis_os.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include <string.h>
#include <stdbool.h>
#include <stdio.h>
#include "pb_encode.h"
#include "pb_decode.h"
#include "pb_common.h"
#include "STO_tests_V2_nanopb.pb.h"
#include "FREERTOS_tasks.h"
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
#define X 0
#define Y 1
#define CRC_POLY  0x12F
#define SPI_DATA_LEN_BITS 32
#define CRC_SPI_SEED 0xFF
#define CRC_LEN 8
#define MSG_LEN 32
#define CRC_SEED 0xFF
#define MAX_CRC 0xFF
#define MAX_UINT64_T 0xFFFFFFFFFFFFFFFF
/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/

FDCAN_HandleTypeDef hfdcan1;

RTC_HandleTypeDef hrtc;

SPI_HandleTypeDef hspi3;

TIM_HandleTypeDef htim1;

UART_HandleTypeDef huart4;

/* Creating tasks headers */
osThreadId_t Init_testHandle;
const osThreadAttr_t Init_test_attributes = {
  .name = "Init_test",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t CAN_periodHandle;
const osThreadAttr_t CAN_period_attributes = {
  .name = "CAN_period",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t Accelerometer_runHandle;
const osThreadAttr_t Accelerometer_run_attributes = {
  .name = "Accelerometer_run",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t Accelerometer_periodHandle;
const osThreadAttr_t Accelerometer_period_attributes = {
  .name = "Accelerometer_period",
  .stack_size = 512*4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t Send_periodicHandle;
const osThreadAttr_t Send_periodic_attributes = {
  .name = "Send_periodic",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t SBR1Handle;
const osThreadAttr_t SBR1_attributes = {
  .name = "SBR1",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t SBR2Handle;
const osThreadAttr_t SBR2_attributes = {
  .name = "SBR2",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t SBR3_4Handle;
const osThreadAttr_t SBR3_4_attributes = {
  .name = "SBR3",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t SBR5Handle;
const osThreadAttr_t SBR5_attributes = {
  .name = "SBR5",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t SBR6Handle;
const osThreadAttr_t SBR6_attributes = {
  .name = "SBR6",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t SBR7Handle;
const osThreadAttr_t SBR7_attributes = {
  .name = "SBR7",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS1Handle;
const osThreadAttr_t UDS1_attributes = {
  .name = "UDS1",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS2Handle;
const osThreadAttr_t UDS2_attributes = {
  .name = "UDS2",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS3Handle;
const osThreadAttr_t UDS3_attributes = {
  .name = "UDS3",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS4aHandle;
const osThreadAttr_t UDS4a_attributes = {
  .name = "UDS4a",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS4bHandle;
const osThreadAttr_t UDS4b_attributes = {
  .name = "UDS4b",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS5Handle;
const osThreadAttr_t UDS5_attributes = {
  .name = "UDS5",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS6Handle;
const osThreadAttr_t UDS6_attributes = {
  .name = "UDS6",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};
osThreadId_t UDS8Handle;
const osThreadAttr_t UDS8_attributes = {
  .name = "UDS8",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS9Handle;
const osThreadAttr_t UDS9_attributes = {
  .name = "UDS9",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS10Handle;
const osThreadAttr_t UDS10_attributes = {
  .name = "UDS10",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};


osThreadId_t UDS11_12_13_14_16Handle;
const osThreadAttr_t UDS11_12_13_14_16_attributes = {
  .name = "UDS6",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};

osThreadId_t UDS15Handle;
const osThreadAttr_t UDS15_attributes = {
  .name = "UDS15",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};




osThreadId_t EDRHandle;
const osThreadAttr_t EDR_attributes = {
  .name = "EDR",
  .stack_size = 512 * 4,
  .priority = (osPriority_t) osPriorityNormal,
};
/* USER CODE BEGIN PV */
FDCAN_TxHeaderTypeDef BCM_CANHS_R_04,BRAKE_CANHS_R_01,DTOOL_to_AIRBAG,CLUSTER_CANHS_RNr_01;
FDCAN_RxHeaderTypeDef RxHeader;

volatile uint32_t time;
uint8_t UARTRXcmd[128]={0,};
uint32_t timelist[50]={0,};

uint8_t SPI_RXbuf[4]={0,0,0,0};
uint8_t SPI_resp[4]={10,20,30,40};
static float XGE_1882_X[801]={-0.139856,-0.279711,-0.139856,0.559422,-0.419567,-0.139856,-0.279711,0.419567,-0.139856,0.978989,-0.839133,0.839133,0.419567,0.419567,-0.419567,0.559422,0.839133,-1.398555,1.538411,-0.978989,0.978989,-0.559422,1.258700,-1.398555,0.978989,-0.839133,0.419567,0.419567,0.279711,0.839133,0.000000,1.258700,-1.818122,1.538411,-0.559422,1.258700,-1.538411,0.559422,-0.559422,0.559422,0.279711,0.000000,0.699278,-0.419567,0.139856,-1.118844,0.699278,-1.258700,0.839133,-1.118844,0.279711,0.000000,0.279711,-0.279711,-0.139856,0.419567,-0.559422,1.118844,-0.978989,0.978989,-0.978989,0.839133,-0.279711,0.699278,-0.279711,0.559422,-0.419567,-0.279711,0.139856,-0.559422,0.559422,-1.118844,0.559422,-0.419567,0.699278,-0.559422,0.279711,-0.559422,0.139856,-0.139856,-0.139856,-0.139856,-0.139856,0.139856,-0.559422,0.279711,0.139856,0.419567,-0.139856,0.139856,0.000000,-0.139856,-0.139856,-0.419567,0.419567,-0.279711,0.699278,0.000000,-0.139856,0.000000,0.139856,0.000000,-0.279711,0.000000,-0.419567,0.699278,0.000000,0.279711,-0.279711,0.139856,0.000000,0.419567,0.279711,-0.139856,0.139856,0.699278,0.139856,0.279711,0.139856,0.139856,-0.139856,-0.139856,0.139856,0.139856,0.279711,0.139856,-0.139856,0.139856,-0.279711,0.139856,0.000000,-0.279711,0.279711,-0.139856,0.279711,0.000000,0.139856,0.000000,0.139856,0.139856,0.139856,0.000000,0.139856,-0.419567,0.139856,0.139856,-0.279711,-0.419567,0.419567,-0.279711,0.000000,-0.559422,0.000000,0.279711,-0.139856,0.279711,-0.139856,0.279711,-0.139856,0.419567,0.000000,0.000000,0.139856,0.000000,0.139856,-0.139856,0.279711,0.419567,0.279711,0.000000,-0.279711,0.000000,-0.139856,0.139856,0.000000,-0.279711,0.279711,0.000000,-0.279711,0.139856,0.139856,0.000000,0.139856,-0.279711,0.139856,-0.139856,0.000000,0.139856,0.000000,0.000000,0.139856,0.139856,-0.139856,0.559422,0.279711,0.139856,0.139856,0.000000,0.419567,0.139856,0.139856,0.139856,0.000000,0.139856,0.419567,0.139856,0.139856,0.419567,0.139856,-0.839133,-0.139856,-0.699278,-1.398555,-1.398555,-3.915955,-0.978989,0.000000,-5.734077,0.419567,-2.517400,-0.279711,-2.517400,1.118844,-1.957977,2.657255,-0.699278,0.000000,-0.279711,5.174655,1.957977,-2.377544,3.776099,-5.174655,0.419567,-2.797111,-7.831910,0.559422,0.839133,-9.090610,-0.559422,-1.957977,-5.454366,-2.936966,-5.873932,-1.538411,-3.216677,-2.237689,-3.636244,-10.908732,4.335522,-4.195666,-3.356533,-6.013788,-6.433355,-5.734077,-10.349310,-3.915955,-4.475377,-2.657255,-7.692054,5.734077,-5.873932,-5.034799,0.279711,1.258700,-3.216677,-8.111621,12.447143,-10.629021,6.713066,-2.657255,2.237689,-5.174655,-3.496388,-9.090610,7.132632,-6.852921,-5.174655,-5.034799,1.258700,-0.559422,-9.510176,-1.818122,-0.559422,-2.657255,0.699278,-2.517400,-8.251477,2.517400,-5.873932,-4.335522,-4.615233,-2.797111,0.139856,-9.090610,-2.097833,0.839133,-7.132632,0.978989,-10.349310,-5.174655,-6.433355,-4.615233,-3.356533,-11.608009,0.559422,-6.573210,-2.097833,-4.195666,0.699278,-5.734077,-0.978989,-5.454366,-3.496388,-4.195666,-0.419567,-1.258700,-4.055811,0.139856,-9.230465,-2.237689,0.000000,-7.412343,-10.629021,-8.111621,-6.293499,-9.370321,-5.454366,-3.356533,-2.377544,-1.818122,-6.293499,-5.873932,-0.279711,-1.258700,-7.831910,-8.671043,-4.475377,-6.852921,-0.279711,-3.356533,0.559422,-6.713066,1.118844,-1.957977,-6.852921,-5.174655,2.377544,-6.433355,3.915955,-9.370321,-4.894944,-4.055811,-0.419567,-8.391332,-4.615233,-4.055811,-3.076822,-2.797111,-6.013788,-5.594221,-5.034799,-0.279711,-6.573210,-2.797111,-3.776099,-2.936966,-4.475377,-0.699278,-4.755088,0.699278,-4.055811,-3.356533,-2.097833,-3.915955,-1.678266,-2.517400,-0.139856,-1.818122,1.818122,-3.076822,0.978989,-3.636244,0.279711,-0.699278,-0.559422,-0.139856,-0.419567,-0.279711,-0.699278,-0.978989,1.258700,-0.978989,-0.839133,2.097833,0.559422,1.118844,-1.678266,3.915955,0.419567,0.559422,0.839133,2.377544,-1.538411,2.517400,-2.377544,2.657255,-1.957977,-3.216677,3.915955,-2.936966,-1.538411,1.678266,-4.335522,-1.118844,-2.657255,0.419567,6.573210,-8.950754,8.111621,-3.496388,1.957977,2.097833,2.657255,-4.755088,3.076822,-1.398555,1.538411,-1.258700,-1.957977,3.915955,-4.055811,1.678266,-2.377544,-0.139856,1.538411,0.978989,-3.776099,5.034799,-3.636244,3.076822,-0.699278,0.139856,0.279711,-1.818122,-1.118844,2.517400,-1.118844,1.258700,1.398555,-1.957977,0.559422,-1.957977,3.496388,-1.957977,-1.538411,-3.356533,1.398555,-4.055811,1.538411,-3.496388,3.776099,-1.678266,1.118844,-3.776099,-0.419567,0.419567,-0.978989,-0.139856,-0.559422,-2.797111,0.559422,-0.839133,-0.139856,-1.118844,-0.419567,0.978989,-1.957977,-1.118844,-1.818122,0.279711,1.258700,-1.538411,-1.957977,-1.538411,0.139856,-0.978989,-0.978989,-1.678266,0.000000,0.000000,-1.818122,-0.139856,-0.699278,1.398555,-0.978989,0.000000,-1.398555,0.419567,-0.139856,0.139856,-0.139856,0.279711,-0.839133,0.978989,-0.279711,-0.279711,0.559422,-0.699278,0.419567,-1.538411,0.559422,-0.839133,0.559422,-1.118844,0.000000,-1.118844,1.118844,-0.559422,0.699278,-0.978989,0.978989,-0.279711,-0.559422,-0.419567,0.279711,-0.279711,-0.699278,-0.139856,-0.279711,0.139856,0.559422,-0.978989,0.559422,-0.419567,-0.699278,0.279711,-0.559422,-0.139856,-0.279711,0.559422,0.139856,-0.139856,-0.699278,-0.279711,1.118844,-0.699278,-0.978989,0.139856,-1.678266,1.818122,-0.839133,0.419567,0.000000,-0.839133,0.419567,-1.258700,0.419567,-0.419567,0.279711,0.139856,-0.559422,0.839133,-0.559422,0.699278,0.279711,0.000000,0.000000,0.279711,-0.699278,0.699278,0.000000,-0.139856,0.559422,0.839133,0.000000,0.000000,0.978989,-0.699278,1.678266,-1.398555,1.118844,-0.978989,0.279711,0.139856,-0.139856,0.139856,0.000000,-0.279711,0.419567,-1.118844,-0.139856,-0.978989,0.419567,-0.419567,-0.559422,-0.559422,1.678266,-0.139856,-1.538411,-0.139856,0.978989,-0.279711,1.538411,2.797111,-0.559422,-4.195666,-0.978989,1.678266,0.839133,-3.915955,-1.957977,2.797111,-2.936966,1.818122,-3.356533,1.258700,-0.559422,-1.957977,-1.118844,-4.475377,2.797111,0.279711,-0.699278,-4.755088,-3.636244,4.195666,-2.797111,3.776099,-4.475377,0.000000,-0.139856,-0.978989,-0.978989,1.957977,0.978989,1.818122,0.559422,-0.699278,0.839133,0.419567,1.398555,-0.139856,0.419567,-2.237689,-0.699278,-1.818122,0.279711,1.957977,-0.139856,-3.356533,0.839133,2.797111,-5.174655,3.356533,-1.118844,2.657255,1.118844,-1.818122,-1.118844,1.818122,-0.279711,-3.076822,3.356533,-5.034799,0.839133,-4.894944,4.615233,-2.237689,-2.097833,-1.398555,2.377544,-2.517400,0.559422,-2.097833,-0.699278,-2.097833,1.258700,3.496388,-7.132632,6.153644,-2.237689,-2.936966,0.699278,0.978989,-1.957977,3.356533,-4.475377,-0.139856,1.538411,-6.852921,4.195666,-1.957977,4.755088,-3.636244,-1.957977,-3.076822,1.678266,-3.496388,1.398555,0.000000,-0.699278,0.559422,-2.936966,0.419567,-3.636244,1.818122,-1.118844,-0.139856,-1.538411,-1.538411,1.957977,-1.398555,0.839133,0.279711,-0.978989,1.538411,-0.279711,-2.936966,1.957977,-1.678266,0.000000,1.118844,-1.538411,0.978989,-0.419567,-2.657255,0.839133,0.139856,0.000000,-1.818122,-0.559422,-0.419567,0.839133,-1.398555,-1.258700,1.818122,-0.279711,-1.538411,1.398555,-2.377544,-0.139856,-0.139856,0.839133,-1.678266,2.237689,-1.258700,-0.559422,0.559422,-1.118844,0.978989,-1.118844,0.139856,0.139856,0.000000,-1.258700,-0.139856,-0.559422,-0.699278,0.559422,-1.678266,-1.258700,0.419567,-1.398555,1.118844,-0.419567,-0.559422,-0.559422,1.258700,-1.258700,1.678266,-1.118844,0.279711,0.839133,-1.118844,0.139856,-0.699278,1.258700,-1.818122,1.258700,-2.097833,0.839133,-1.398555,0.978989,-0.978989,1.118844,-1.258700,-0.279711,0.139856,-0.419567,0.000000,0.139856,-0.279711,-0.279711,-0.419567,0.139856,0.419567,0.279711,0.139856,0.419567,-0.978989};
static float XGE_1882_Y[801]={-0.136337,-0.136337,0.409010,0.136337,0.136337,0.000000,0.545346,-0.272673,-0.954356,-0.681683,0.000000,0.545346,-0.272673,0.136337,0.681683,0.818020,-0.272673,-0.545346,-0.681683,0.000000,-0.136337,0.136337,0.545346,0.000000,0.409010,-0.136337,0.000000,0.136337,0.136337,0.545346,0.681683,0.681683,-0.409010,0.272673,0.681683,0.409010,0.545346,0.136337,-0.818020,-0.681683,0.954356,0.545346,-0.681683,-0.272673,0.409010,0.136337,-0.136337,-0.409010,0.136337,0.136337,0.136337,0.272673,0.272673,0.136337,0.136337,0.272673,0.000000,0.136337,-0.136337,-0.409010,-0.136337,0.272673,0.681683,-0.136337,0.272673,-0.136337,-0.136337,0.000000,0.272673,-0.136337,0.000000,0.136337,-0.272673,0.272673,-0.409010,0.136337,-0.136337,0.409010,-0.681683,0.000000,0.272673,0.545346,0.409010,-0.272673,0.136337,0.136337,0.136337,0.000000,0.000000,-0.409010,0.000000,0.545346,-0.136337,0.136337,0.136337,0.409010,0.000000,-0.545346,0.545346,0.000000,-0.545346,0.000000,0.272673,0.000000,-0.409010,0.409010,-0.136337,0.136337,0.409010,0.272673,0.272673,-0.136337,0.409010,-0.272673,0.545346,0.409010,0.136337,0.000000,-0.136337,0.272673,0.272673,-0.136337,-0.409010,-0.136337,0.409010,0.545346,0.000000,0.136337,0.000000,-0.136337,-0.272673,-0.409010,0.136337,0.409010,0.272673,0.136337,0.136337,0.136337,0.136337,-0.136337,-0.136337,-0.136337,-0.136337,-0.272673,-0.136337,0.136337,-0.272673,0.272673,0.272673,-0.272673,0.136337,-0.136337,-0.272673,0.000000,0.136337,-0.136337,-0.136337,0.409010,0.272673,0.272673,0.136337,0.000000,0.000000,0.136337,0.000000,0.272673,0.272673,0.136337,0.272673,0.136337,0.272673,0.000000,-0.272673,0.272673,0.545346,0.136337,0.681683,-0.272673,0.000000,0.272673,0.545346,-0.136337,0.000000,0.000000,-0.136337,0.000000,0.136337,0.000000,0.136337,0.000000,0.000000,0.409010,0.000000,0.272673,-0.136337,-0.136337,-0.136337,-0.272673,0.272673,0.000000,0.545346,0.136337,0.136337,0.272673,0.409010,0.409010,-0.136337,0.272673,0.545346,0.000000,0.818020,1.636039,2.181386,2.590395,2.999405,2.454059,3.135742,0.681683,-0.272673,-0.272673,-1.090693,1.908712,0.409010,1.227029,-1.636039,0.681683,-4.090098,-0.272673,-1.772376,3.681088,4.635445,0.000000,-0.272673,3.817425,4.226435,-2.181386,0.136337,-0.681683,8.861879,2.045049,1.090693,-3.817425,5.862474,8.589206,4.635445,0.136337,-3.681088,0.136337,-1.772376,0.136337,5.044454,9.270889,8.725543,4.635445,3.135742,0.818020,-1.227029,5.044454,3.544752,5.998811,-1.227029,0.954356,3.544752,0.681683,-3.408415,-4.090098,-1.772376,-2.590395,8.452869,11.043265,4.226435,-8.316533,10.634255,8.725543,5.589801,-2.045049,3.544752,8.452869,0.681683,0.000000,2.863069,9.543562,-3.817425,1.772376,5.180791,9.952572,5.180791,-4.090098,0.545346,3.272078,-1.908712,0.681683,1.772376,7.225840,8.589206,6.816830,-0.272673,1.636039,10.906928,7.498513,7.225840,3.817425,2.999405,5.998811,4.226435,3.272078,5.589801,1.772376,7.907523,6.544157,2.863069,0.545346,1.636039,7.771186,6.544157,4.090098,-3.953761,5.044454,9.952572,10.088909,5.862474,10.634255,13.088314,9.816235,6.407820,5.998811,6.953167,5.317128,9.816235,3.681088,5.453464,8.998216,8.589206,6.407820,6.680494,3.135742,10.634255,14.724353,1.499703,0.136337,8.998216,2.045049,5.998811,3.817425,10.225245,1.772376,7.089503,6.271484,2.454059,5.317128,8.725543,6.544157,0.818020,9.270889,7.498513,9.270889,7.089503,4.908118,3.408415,6.816830,10.361582,7.771186,5.180791,5.998811,8.589206,10.497918,4.635445,3.408415,5.726137,4.771781,5.180791,3.817425,4.226435,4.226435,5.044454,1.908712,0.545346,2.454059,3.953761,5.044454,6.680494,4.362771,0.000000,2.317722,3.272078,1.499703,3.817425,4.090098,2.726732,-1.090693,2.454059,3.681088,3.953761,2.590395,1.499703,0.681683,1.363366,3.272078,1.772376,1.227029,-0.136337,2.454059,-0.272673,1.499703,3.681088,0.681683,1.908712,0.818020,-2.590395,3.135742,0.272673,2.726732,2.726732,-4.635445,1.636039,-0.272673,2.045049,-6.953167,-0.954356,6.680494,-1.636039,-4.090098,3.681088,0.136337,-4.090098,2.726732,4.090098,0.954356,0.000000,-1.636039,2.181386,-2.863069,-0.272673,2.181386,-3.681088,1.908712,-1.772376,0.000000,-0.136337,0.409010,-0.818020,-0.818020,-1.227029,1.772376,-2.454059,1.227029,0.000000,-0.681683,2.181386,-2.454059,0.545346,-0.545346,2.317722,2.181386,-1.908712,-1.908712,0.681683,-0.272673,-3.544752,-1.227029,2.454059,0.681683,-2.181386,0.272673,1.772376,-1.772376,1.636039,-1.227029,4.635445,-0.545346,-1.363366,-0.545346,-0.545346,1.227029,-1.499703,0.272673,2.181386,0.681683,-1.227029,1.227029,2.181386,-0.136337,-1.363366,0.818020,2.045049,0.681683,0.136337,-0.409010,-0.136337,0.136337,0.954356,-1.090693,-0.136337,0.954356,0.272673,0.545346,-1.090693,0.545346,-1.090693,1.227029,0.136337,0.409010,-0.409010,-0.272673,1.227029,-1.227029,0.409010,-0.272673,0.545346,1.090693,0.272673,-0.409010,0.954356,0.545346,0.000000,-1.363366,0.545346,0.136337,0.272673,-0.954356,0.681683,-0.272673,-0.136337,0.000000,-0.136337,-0.954356,1.227029,-0.272673,0.000000,-0.272673,0.000000,0.545346,-0.818020,0.545346,-0.272673,0.818020,-0.409010,-0.818020,-0.136337,-0.681683,-0.545346,-0.545346,0.818020,0.545346,-0.272673,-0.681683,-0.681683,0.681683,1.227029,-1.227029,-0.136337,-0.818020,-0.136337,0.409010,-0.545346,0.818020,-0.818020,0.136337,-0.545346,0.000000,0.409010,-0.272673,1.499703,-0.681683,0.136337,-0.272673,-0.136337,1.227029,-0.409010,-0.272673,0.136337,-0.681683,-0.681683,-0.409010,0.409010,-0.818020,-0.409010,0.136337,-0.272673,-0.818020,-1.090693,-0.409010,0.000000,-0.954356,-0.272673,-0.409010,1.499703,0.272673,0.000000,-0.272673,-0.409010,0.272673,-0.545346,-0.136337,-0.272673,0.409010,0.681683,-0.545346,-1.090693,-2.317722,1.636039,3.953761,-0.818020,0.136337,-5.044454,5.180791,6.816830,0.545346,-5.453464,-1.772376,0.000000,0.000000,1.499703,-7.498513,1.227029,1.363366,2.590395,-7.634850,-2.317722,5.180791,1.772376,0.136337,-6.680494,-0.409010,5.589801,2.726732,-2.045049,-7.907523,1.636039,0.545346,-1.363366,-1.090693,-3.817425,-1.908712,-1.227029,1.363366,-1.090693,2.045049,-2.726732,-1.363366,2.726732,1.636039,-0.954356,-3.272078,2.590395,2.999405,-2.454059,0.545346,-1.908712,4.499108,0.681683,-0.545346,0.000000,-4.771781,5.998811,-5.453464,-2.590395,1.908712,-1.227029,-6.271484,2.454059,2.863069,1.363366,-0.545346,-2.999405,2.590395,1.499703,-4.908118,1.090693,8.316533,2.726732,-6.953167,-0.818020,6.544157,-1.227029,-4.908118,-3.817425,3.817425,-2.863069,-2.999405,2.590395,-2.045049,-2.045049,0.272673,1.499703,-0.545346,-0.818020,-3.681088,2.726732,2.181386,-2.045049,0.545346,-0.409010,0.545346,3.272078,-2.454059,-3.135742,-0.954356,-0.954356,2.181386,-0.818020,0.136337,-3.135742,-1.499703,3.135742,-2.863069,-1.772376,0.818020,-0.136337,2.454059,-1.227029,1.363366,-4.090098,0.000000,1.363366,-0.954356,2.590395,-1.227029,-0.818020,-1.499703,0.136337,-0.681683,0.409010,-1.090693,-0.409010,1.772376,-1.090693,-0.136337,1.772376,-0.136337,0.409010,0.681683,0.000000,-1.908712,-0.272673,0.545346,1.227029,-1.227029,-1.227029,-0.545346,-0.409010,0.818020,-0.272673,-1.227029,1.227029,1.636039,-1.908712,0.818020,1.499703,1.090693,-0.545346,0.954356,0.136337,0.272673,0.136337,0.818020,1.090693,-0.136337,-0.272673,-0.272673,-0.136337,-0.136337,-0.681683,-0.954356,0.954356,0.409010,-1.499703,0.409010,0.409010,-0.545346,0.409010,0.545346,-0.409010,0.954356,-0.545346,0.000000,-0.272673,-0.136337,-0.272673,-0.818020,0.545346,-0.136337,0.545346,-1.499703,0.954356,-0.818020,-0.681683,-0.272673,0.545346,-0.272673,0.000000,-0.545346,-0.545346,0.681683,-0.409010,-0.409010,0.000000,-0.136337,0.545346,-0.272673,-0.545346};
static float XGE_1883_X[801]={0.000000,0.139856,0.139856,-0.279711,0.000000,-0.139856,0.279711,-0.139856,-0.139856,0.000000,0.139856,-0.279711,0.139856,-0.419567,0.419567,0.139856,-0.139856,0.000000,0.139856,0.000000,0.000000,0.000000,0.000000,-0.139856,0.279711,0.000000,0.139856,0.000000,-0.139856,0.000000,-0.419567,-0.419567,-0.139856,-0.419567,-0.279711,-0.279711,0.279711,-0.279711,0.000000,0.000000,0.000000,-0.139856,0.139856,0.000000,0.559422,-0.279711,-0.139856,-0.139856,0.000000,0.000000,-0.139856,0.000000,0.000000,-0.279711,-0.419567,-0.139856,-0.419567,-0.139856,0.000000,-0.279711,0.139856,0.139856,-0.139856,0.000000,-0.139856,-0.139856,-0.419567,0.279711,-0.279711,0.419567,-0.139856,-0.419567,0.279711,0.000000,0.139856,0.000000,-0.279711,0.279711,-0.139856,-0.279711,0.000000,-0.559422,0.000000,0.000000,0.000000,0.000000,0.000000,-0.139856,0.000000,-0.139856,-0.139856,-0.139856,-0.139856,0.000000,0.000000,0.000000,-0.139856,0.139856,0.000000,-0.139856,0.000000,-0.419567,0.000000,0.000000,0.139856,0.559422,-0.139856,0.139856,0.139856,0.279711,-0.139856,0.000000,-0.139856,-0.139856,0.139856,0.000000,0.139856,-0.139856,0.559422,-0.139856,0.000000,0.419567,-0.279711,-0.419567,0.139856,0.000000,-0.279711,0.279711,-0.419567,-0.699278,-0.839133,-0.559422,0.139856,0.000000,-0.419567,-0.279711,0.139856,0.000000,-0.139856,0.559422,0.000000,-0.279711,-0.279711,0.000000,-0.419567,-0.419567,0.139856,-0.279711,-0.139856,0.139856,0.139856,0.139856,-0.279711,0.000000,0.000000,-0.279711,0.139856,0.000000,0.000000,-0.419567,0.139856,0.139856,0.000000,-0.139856,-0.279711,-0.139856,0.139856,-0.139856,-0.279711,0.000000,-0.279711,0.000000,-0.419567,0.000000,-0.279711,0.279711,-0.139856,-0.139856,-0.279711,0.279711,0.279711,-0.419567,0.000000,-0.139856,0.139856,-0.139856,-0.139856,-0.139856,-0.139856,-0.279711,-0.279711,-0.279711,-0.139856,0.139856,0.139856,0.279711,0.139856,0.279711,-0.139856,0.000000,0.139856,0.000000,0.139856,0.000000,0.139856,0.559422,0.699278,1.118844,1.678266,0.419567,0.559422,2.377544,-0.559422,0.839133,0.978989,1.538411,5.034799,8.391332,14.405120,3.496388,-12.307287,6.573210,7.272488,18.181220,14.405120,25.873274,22.237030,11.468154,16.363098,25.313852,-0.279711,12.726854,10.209454,18.321075,3.216677,8.111621,4.755088,1.258700,9.510176,6.293499,11.747865,11.188443,-13.146420,11.468154,-1.957977,19.859486,7.831910,6.153644,18.600786,15.523964,28.670385,11.328298,11.048587,4.055811,-14.824687,19.439919,7.692054,1.258700,8.391332,22.237030,4.615233,4.475377,9.650032,-0.279711,26.432696,2.377544,26.152985,9.929743,24.195007,3.356533,15.244253,7.552199,17.342086,9.510176,7.552199,10.349310,2.237689,7.971765,4.755088,12.586998,-2.097833,12.167432,2.237689,4.755088,3.216677,11.887720,4.475377,9.510176,6.153644,5.873932,8.251477,3.216677,5.454366,8.391332,4.335522,2.797111,9.090610,3.496388,4.894944,9.789887,6.293499,9.090610,0.699278,3.496388,3.636244,1.538411,-0.559422,4.335522,-1.678266,5.873932,-2.097833,0.000000,-0.699278,5.734077,-0.699278,0.279711,6.153644,1.538411,0.839133,3.915955,0.000000,5.594221,0.419567,1.398555,2.517400,6.153644,0.699278,4.055811,-4.894944,2.797111,8.531188,2.377544,2.517400,2.517400,-2.097833,0.419567,0.000000,0.139856,-2.097833,-0.139856,0.139856,-2.237689,0.279711,-2.517400,3.915955,-0.699278,4.055811,-3.636244,0.419567,-1.957977,7.971765,-5.734077,5.594221,-2.936966,0.978989,-0.839133,4.755088,-7.831910,10.629021,-7.132632,5.734077,-6.573210,3.356533,0.978989,1.398555,1.538411,1.957977,1.957977,-2.797111,3.915955,-0.279711,-1.538411,0.559422,-0.139856,-0.699278,1.957977,-3.356533,1.118844,1.398555,0.839133,-1.538411,-1.398555,-2.657255,7.132632,-4.335522,0.839133,1.538411,-1.398555,-1.258700,0.139856,-3.216677,4.055811,-1.118844,-2.797111,2.657255,-0.559422,2.097833,-0.978989,0.279711,0.978989,-0.839133,0.559422,0.699278,-2.237689,1.818122,0.279711,1.118844,0.839133,2.377544,-1.957977,3.216677,-1.678266,2.797111,-3.076822,0.419567,2.517400,-2.517400,1.678266,-0.559422,-0.839133,1.957977,-0.839133,0.559422,1.678266,-3.216677,3.076822,-0.419567,0.139856,-2.936966,0.139856,-0.419567,0.419567,-1.398555,-0.699278,0.839133,-0.279711,-0.839133,-0.839133,0.839133,-1.258700,1.818122,-0.559422,-1.258700,0.000000,-0.139856,-0.279711,1.818122,-0.559422,-0.139856,1.957977,-1.118844,-1.538411,3.776099,-1.678266,3.356533,-0.978989,0.559422,2.797111,-3.356533,-0.279711,0.559422,-1.538411,1.678266,-1.258700,2.097833,1.258700,0.000000,1.118844,-0.978989,0.139856,-1.118844,0.000000,-1.258700,-0.559422,-1.678266,0.978989,-0.559422,0.699278,0.139856,-1.118844,1.957977,-2.797111,0.419567,-1.118844,0.000000,-0.559422,-0.839133,0.000000,-0.699278,-0.419567,0.559422,-1.818122,-0.978989,0.839133,-0.279711,0.839133,-0.978989,-0.419567,-1.118844,-0.419567,-0.699278,-1.538411,0.419567,0.559422,-0.839133,0.559422,-0.699278,-0.139856,0.279711,-1.258700,-0.139856,-0.559422,0.000000,-1.538411,-0.139856,-1.258700,-0.419567,-2.097833,-0.839133,-0.839133,-0.839133,0.000000,0.279711,0.000000,0.419567,-0.559422,0.559422,0.139856,0.279711,1.258700,-1.118844,0.699278,-0.839133,-0.279711,0.699278,0.000000,0.000000,1.258700,-0.419567,-0.139856,0.000000,0.279711,0.419567,0.139856,1.258700,-0.279711,1.118844,-1.118844,0.139856,0.000000,0.139856,0.559422,-0.139856,0.419567,0.419567,-0.839133,0.699278,-0.139856,0.699278,-0.559422,0.000000,-1.258700,-0.139856,-0.978989,-2.097833,1.538411,-0.419567,-0.699278,0.139856,-0.839133,1.398555,-1.398555,0.559422,0.419567,0.279711,1.818122,-0.699278,0.000000,-0.839133,0.279711,0.559422,-0.839133,-0.139856,0.000000,-0.419567,-0.419567,0.139856,-0.139856,0.419567,-1.398555,1.258700,-0.279711,0.279711,0.139856,-0.139856,-0.419567,-0.279711,0.000000,0.000000,0.000000,-0.699278,-0.139856,0.139856,-0.419567,-0.279711,-0.419567,0.559422,-0.559422,0.000000,-0.559422,-0.139856,-0.279711,-0.559422,-1.118844,-0.699278,-0.279711,-0.419567,-0.419567,-0.279711,-0.839133,-0.699278,-0.139856,-0.279711,-0.139856,-0.279711,0.559422,-0.699278,-0.839133,0.279711,-0.559422,0.000000,-0.279711,-0.559422,-0.279711,0.139856,-0.419567,-0.139856,-2.517400,0.839133,0.559422,-0.559422,0.139856,0.000000,2.377544,-2.097833,-0.559422,-1.398555,-0.419567,0.839133,1.818122,-3.915955,0.279711,3.636244,-4.755088,1.398555,-2.797111,0.139856,-0.279711,-2.097833,1.258700,-4.615233,2.797111,-0.699278,0.279711,-1.538411,-0.839133,2.377544,-1.538411,0.978989,-1.538411,-1.118844,1.957977,2.936966,-2.657255,1.818122,3.076822,1.118844,-7.132632,3.496388,-0.978989,-1.957977,4.335522,-0.139856,0.000000,-3.216677,-0.419567,1.118844,1.118844,-5.454366,5.314510,-3.076822,2.517400,-0.279711,-3.636244,3.776099,-3.915955,0.559422,2.517400,-1.258700,0.139856,1.258700,0.419567,-0.699278,0.139856,-0.139856,-1.538411,1.398555,0.139856,-1.678266,0.839133,0.419567,-0.559422,0.279711,-2.377544,2.797111,-3.496388,1.957977,-0.139856,-1.398555,1.398555,-1.818122,-0.978989,-0.699278,0.419567,-1.118844,-0.419567,0.139856,-0.978989,-0.559422,1.258700,-1.818122,0.139856,0.839133,-1.818122,-0.279711,-0.139856,-1.538411,1.118844,-0.279711,-0.139856,0.000000,-1.957977,1.118844,0.559422,-1.678266,0.139856,0.559422,-0.419567,-0.139856,-0.419567,-0.279711,0.279711,-0.839133,0.000000,-0.419567,0.000000,0.000000,0.000000,-0.279711,-1.118844,-0.699278,-1.258700,0.839133,0.419567,-1.398555,0.000000,0.000000,-0.839133,3.915955,-2.377544,-1.538411,2.657255,-3.915955,-2.797111,-1.818122,-0.419567,1.818122,-4.055811,5.734077,-2.517400,-1.957977,5.594221,-7.971765,4.615233,-5.454366,5.734077,-5.873932,4.195666,-1.118844,-1.538411,1.957977,-4.755088,3.496388,-5.734077,8.810899,-7.692054,5.734077,0.839133,-0.559422,6.013788,-8.251477};
static float XGE_1883_Y[801]={0.000000,0.136337,0.272673,0.136337,0.272673,0.272673,0.000000,0.000000,0.136337,0.409010,0.409010,0.136337,0.136337,0.272673,0.409010,0.000000,0.272673,0.409010,0.272673,0.000000,0.000000,-0.136337,0.136337,0.000000,0.136337,0.000000,-0.136337,-0.136337,0.000000,0.272673,0.000000,0.136337,0.000000,0.000000,0.272673,0.136337,0.272673,-0.272673,-0.136337,-0.136337,0.000000,0.000000,0.409010,-0.272673,0.545346,0.409010,0.136337,0.000000,0.000000,-0.136337,0.136337,0.272673,-0.136337,0.136337,0.136337,0.000000,0.000000,0.000000,-0.136337,0.272673,0.272673,-0.136337,0.000000,0.681683,0.136337,0.000000,-0.136337,0.000000,0.272673,0.272673,0.409010,0.136337,0.136337,-0.136337,-0.136337,0.000000,0.000000,0.409010,0.136337,0.545346,0.272673,0.136337,0.136337,0.000000,-0.136337,-0.136337,-0.136337,0.136337,0.136337,0.272673,-0.272673,0.136337,-0.409010,-0.136337,0.136337,0.272673,0.136337,0.272673,0.272673,0.136337,-0.136337,-0.409010,-0.136337,0.000000,-0.136337,-0.136337,0.272673,0.136337,0.545346,0.136337,0.000000,0.409010,0.136337,0.000000,0.272673,-0.136337,-0.136337,0.272673,0.409010,0.000000,0.000000,0.136337,-0.136337,0.136337,0.409010,0.409010,-0.545346,0.545346,-0.136337,-0.272673,0.409010,0.000000,0.136337,0.000000,0.136337,-0.136337,-0.136337,0.136337,0.136337,0.136337,0.136337,-0.136337,-0.136337,0.000000,-0.136337,0.000000,0.272673,0.000000,-0.272673,0.000000,0.136337,0.545346,0.136337,0.136337,0.000000,0.136337,0.136337,-0.136337,-0.545346,-0.136337,0.000000,-0.136337,0.272673,-0.409010,0.000000,0.136337,-0.272673,0.136337,0.000000,0.000000,0.136337,0.136337,0.409010,0.000000,0.136337,0.136337,0.136337,0.272673,-0.136337,0.000000,0.272673,0.000000,0.136337,0.000000,0.409010,0.136337,0.000000,-0.136337,0.136337,-0.272673,0.136337,0.000000,-0.136337,0.136337,0.136337,0.545346,-0.272673,0.136337,0.409010,0.000000,0.000000,0.000000,0.136337,-0.136337,0.000000,-0.545346,-0.545346,-1.227029,-1.499703,-0.818020,-1.636039,-0.545346,-0.136337,-0.272673,-0.681683,-2.726732,-4.362771,-10.225245,-16.360392,-17.587422,-26.176628,-21.950193,-19.359798,-7.771186,2.726732,5.044454,5.862474,-21.541183,-26.312964,-8.180196,-4.499108,-0.818020,-11.179601,-10.634255,-20.314154,-14.588017,-11.315938,-3.135742,12.542967,2.317722,0.136337,0.545346,-12.815641,0.409010,-5.726137,2.590395,-25.494945,-6.816830,-7.907523,-1.772376,4.499108,-27.403657,-5.453464,-12.951977,-28.630687,-36.401873,-3.544752,-4.090098,0.272673,-6.680494,-2.726732,-23.040886,-14.042670,-6.953167,-6.135147,-2.317722,-14.179007,1.090693,-23.586232,-7.771186,-8.043860,-7.089503,-4.908118,-12.951977,-12.133958,-9.543562,-9.679899,-12.270294,-10.906928,-1.363366,-10.225245,-14.451680,-4.499108,-5.726137,-1.363366,-12.815641,-2.590395,-2.454059,-7.907523,-8.861879,-9.816235,-12.133958,-8.589206,0.272673,2.181386,-8.725543,-12.270294,-10.770592,-8.861879,-4.090098,-7.634850,-2.454059,-4.771781,-7.634850,-7.498513,-6.271484,-3.681088,-4.499108,-0.136337,1.908712,-0.681683,-1.363366,-3.408415,-4.226435,-3.544752,-0.681683,5.317128,-0.818020,-2.590395,-4.362771,-4.908118,-4.635445,-4.771781,-2.454059,5.044454,-5.180791,-8.180196,1.499703,-7.498513,1.636039,3.272078,1.227029,-1.227029,-2.045049,-2.590395,3.408415,-0.272673,2.726732,6.135147,-0.954356,5.589801,-3.408415,-1.636039,4.499108,3.544752,1.227029,2.590395,-1.772376,0.409010,7.225840,1.227029,-5.180791,7.498513,2.045049,-4.090098,1.090693,-0.681683,0.545346,1.090693,-0.545346,-5.726137,2.863069,-0.409010,1.499703,-2.726732,4.226435,2.317722,-5.044454,-0.545346,-2.181386,1.363366,3.272078,4.908118,-3.681088,-1.636039,1.363366,2.726732,3.135742,0.954356,0.409010,2.454059,-0.272673,-0.954356,-2.863069,0.136337,2.726732,0.272673,-1.363366,-0.409010,-1.090693,-1.772376,0.818020,0.136337,3.135742,-2.181386,-2.590395,-1.772376,1.090693,-1.227029,-1.363366,-0.954356,-0.409010,-1.363366,-0.681683,-0.136337,-0.681683,0.136337,3.681088,-0.136337,1.227029,-1.090693,-1.772376,1.227029,0.000000,1.772376,1.636039,-5.180791,3.544752,1.227029,-1.908712,2.045049,-1.090693,0.136337,-0.954356,0.272673,1.363366,1.227029,-1.908712,-2.045049,-0.681683,-1.227029,1.090693,3.544752,0.409010,0.136337,-2.317722,0.136337,2.454059,0.681683,1.772376,0.272673,-0.545346,-1.363366,-0.681683,0.272673,0.681683,1.499703,0.136337,-2.590395,2.726732,-1.772376,0.409010,1.636039,-1.090693,2.454059,0.272673,-1.908712,-0.545346,0.818020,0.818020,-1.363366,-1.499703,-0.136337,-0.272673,0.409010,1.772376,0.136337,0.545346,-0.409010,0.272673,1.363366,0.409010,1.363366,-0.545346,-1.227029,-1.090693,-0.272673,0.545346,0.409010,-0.136337,0.136337,-0.545346,1.363366,0.545346,-0.818020,1.090693,-0.818020,1.227029,0.136337,0.000000,0.409010,0.409010,1.363366,0.954356,0.136337,0.681683,0.136337,0.000000,-0.681683,-0.954356,-0.818020,-0.272673,2.726732,-0.409010,-0.272673,1.090693,0.000000,-0.136337,-0.818020,0.272673,0.681683,1.090693,0.818020,1.499703,1.227029,0.000000,1.090693,-0.409010,-0.272673,0.954356,0.409010,1.363366,1.499703,0.818020,-0.136337,0.136337,1.090693,-0.681683,-0.136337,0.545346,0.272673,0.136337,-0.818020,-0.954356,0.000000,0.136337,0.954356,0.000000,-0.818020,-1.090693,-0.954356,0.136337,0.409010,0.681683,-0.272673,0.136337,0.000000,-0.272673,0.818020,0.000000,-0.272673,0.409010,-0.272673,0.681683,0.272673,-0.136337,0.545346,-0.136337,0.136337,0.818020,0.136337,-0.545346,0.136337,-0.681683,-0.272673,0.954356,-1.772376,0.136337,0.681683,0.136337,-0.545346,-0.954356,1.090693,1.227029,1.772376,0.136337,-1.499703,-0.136337,0.000000,0.954356,1.908712,0.818020,-0.136337,0.409010,0.000000,0.000000,-0.409010,0.272673,0.681683,-0.272673,0.136337,0.681683,0.272673,1.227029,0.545346,0.000000,-1.090693,0.545346,0.136337,0.681683,-0.136337,0.409010,0.136337,-0.409010,0.409010,0.000000,0.000000,0.136337,0.409010,0.681683,0.545346,0.409010,-0.818020,-0.409010,0.272673,0.545346,0.409010,0.681683,1.090693,0.681683,-0.136337,0.272673,0.545346,0.545346,0.272673,0.681683,-0.545346,0.136337,0.409010,-0.545346,-0.409010,0.545346,0.545346,-0.136337,0.000000,-0.136337,0.136337,0.818020,0.681683,0.272673,0.272673,1.227029,-0.409010,-0.272673,-1.090693,0.272673,2.863069,-1.908712,0.272673,0.818020,1.090693,-0.681683,0.545346,-1.090693,0.000000,1.363366,-2.317722,-0.136337,-0.818020,0.409010,-2.999405,0.272673,0.545346,-2.045049,1.772376,-2.045049,-0.136337,-0.136337,-1.499703,3.408415,1.636039,1.499703,-2.045049,0.818020,3.135742,0.954356,-2.045049,-0.409010,1.772376,-1.908712,0.954356,0.272673,0.681683,3.135742,0.000000,-3.408415,2.181386,-0.272673,-0.545346,-0.136337,-0.681683,-0.272673,-0.409010,2.045049,2.045049,-1.499703,2.454059,1.227029,-2.317722,1.227029,3.544752,-0.136337,-1.363366,0.818020,0.136337,0.409010,-0.545346,1.499703,-0.545346,1.499703,-1.636039,0.000000,0.136337,0.409010,1.499703,0.545346,-0.681683,-0.818020,-2.454059,2.726732,-0.545346,-0.272673,-1.227029,-1.227029,0.000000,0.136337,-0.954356,-0.545346,0.545346,0.818020,-0.409010,0.136337,-0.954356,-1.227029,0.681683,-0.954356,-0.409010,0.954356,-0.681683,-0.136337,0.818020,0.409010,-0.681683,0.272673,0.272673,1.363366,0.136337,0.000000,0.136337,-0.409010,1.227029,-0.136337,-0.136337,-0.409010,1.772376,0.681683,-0.272673,-0.136337,-0.681683,0.545346,0.681683,1.227029,0.000000,-0.409010,-2.863069,1.636039,5.453464,-1.772376,-3.681088,3.135742,0.136337,0.000000,-4.499108,1.227029,0.409010,-4.090098,2.999405,-2.999405,5.998811,-2.317722,-2.590395,-0.409010,1.090693,0.272673,-6.544157,6.271484,2.454059,-0.818020,-0.272673,1.227029,4.499108,0.818020,1.636039,-0.409010,-1.772376,-3.135742,2.999405,1.090693,-4.226435,5.862474,0.000000};
static float XGE_1885_X[801]={0.139910, 0.279820, 0.139910,0.000000,0.279820,-0.139910,0.559640,-0.139910,0.279820,0.419730,0.279820,0.000000,0.000000,0.139910,0.139910,0.279820,0.419730,0.279820,-0.139910,-0.279820,0.139910,0.279820,-0.139910,0.279820,-0.419730,0.139910,-0.559640,0.559640,0.139910,0.699550,-0.419730,-0.139910,0.000000,-0.559640,0.279820,0.559640,0.000000,0.000000,-0.559640,0.419730,-0.419730,0.000000,-0.139910,-0.279820,0.839460,0.139910,-0.139910,0.000000,0.000000,-0.139910,0.279820,-0.559640,0.000000,-0.419730,0.000000,0.000000,-0.139910,0.279820,-0.139910,-0.279820,0.000000,-0.419730,-0.139910,-0.279820,-0.139910,-0.279820,0.139910,-0.419730,-0.139910,0.139910,0.279820,0.139910,-0.139910,0.139910,0.419730,-0.699550,0.279820,0.139910,-0.139910,0.559640,-0.139910,-0.419730,0.139910,-0.419730,0.000000,-0.139910,-0.279820,-0.139910,-0.279820,0.419730,-0.559640,0.000000,0.000000,-0.559640,0.839460,-0.839460,0.419730,-1.259190,-0.139910,-0.279820,0.559640,-0.139910,0.839460,-0.279820,0.000000,-0.139910,0.139910,-0.279820,-0.139910,0.000000,-0.139910,-0.279820,-0.559640,-0.139910,-0.279820,0.279820,0.139910,-0.699550,0.279820,-0.279820,0.139910,-0.139910,1.119280,-0.839460,-0.139910,-0.279820,-0.559640,0.419730,-0.559640,0.839460,-0.699550,0.139910,-0.139910,0.419730,0.000000,0.139910,0.279820,-0.279820,0.139910,0.279820,-0.279820,0.559640,-0.699550,-0.419730,-0.139910,0.419730,-0.279820,-0.139910,-0.279820,-0.139910,0.279820,-0.139910,0.419730,0.419730,0.419730,0.139910,0.139910,-0.139910,0.139910,0.279820,0.000000,0.139910,0.279820,0.139910,0.419730,0.139910,-0.139910,-0.139910,0.000000,-0.279820,0.279820,0.279820,0.000000,0.839460,0.139910,-0.139910,0.139910,0.000000,0.139910,0.559640,-0.559640,0.699550,-0.419730,0.559640,0.279820,0.139910,0.699550,-0.419730,0.419730,0.000000,0.419730,0.419730,-0.699550,0.559640,-0.139910,0.139910,0.839460,-0.419730,0.419730,-0.139910,0.419730,-0.699550,0.279820,0.279820,-0.839460,1.818830,-3.217930,1.539010,-0.279820,-14.410732,6.156041,-4.756941,1.259190,5.736311,-0.279820,-21.965873,18.608032,-9.513881,-8.394601,-4.756941,1.259190,-12.312082,-13.711182,3.777570,-3.777570,-11.892352,14.830462,-10.493251,-15.949742,-5.036761,-9.513881,-16.369472,-5.036761,-6.715681,-19.867223,-6.016131,-32.599034,18.468122,-34.837594,14.970372,6.435861,-1.958740,-9.234061,-3.078020,-12.731812,0.839460,3.917481,0.000000,-7.415231,-5.176671,-32.599034,-14.270822,-10.073521,2.098650,1.259190,-6.575771,-2.658290,-13.711182,-0.979370,2.518380,2.938110,2.938110,-13.571272,-0.419730,-7.555141,-10.073521,-13.291452,28.401734,-28.681554,1.119280,-12.451992,-11.332711,-1.818830,-12.451992,2.798200,-0.419730,-9.653791,-0.139910,-26.722813,9.933611,6.715681,-15.250192,-14.970372,17.208932,-12.032262,-27.282454,16.929112,-6.855591,-3.777570,6.295951,-15.949742,7.415231,-21.546143,-12.871722,-17.908482,11.052891,-10.353341,-7.695051,-4.756941,1.539010,10.353341,-15.530012,0.839460,9.513881,-39.594535,46.869856,-25.463623,6.016131,-3.637660,-13.011632,9.653791,-25.603533,7.135411,-3.497750,-14.970372,-2.938110,10.213431,-5.176671,-28.821464,1.818830,-20.007133,-2.518380,13.151542,-38.055525,24.064523,-29.660924,11.332711,-3.917481,-16.509382,13.571272,-20.286953,2.378470,-26.303083,1.119280,-44.631296,3.777570,-20.007133,-16.789202,5.036761,-19.307582,-16.089652,-10.633161,-38.335345,11.192801,-33.858224,13.151542,-31.060024,-10.912981,-14.130912,-15.390102,10.073521,-8.814331,-20.566773,-12.032262,-6.715681,-32.459124,22.105783,-41.133545,-3.917481,-17.488752,-21.825963,-12.312082,-18.747942,-18.468122,-24.484253,-42.112915,15.250192,-61.140678,21.406233,-17.768572,-22.805333,27.142544,-58.762208,-5.596401,-1.818830,-9.933611,-20.566773,-7.415231,-11.332711,-7.555141,-14.550642,-26.163173,5.596401,-23.784703,-14.830462,-23.364973,-6.575771,-8.674421,-15.390102,-15.809832,-23.085153,-12.172172,-21.546143,-13.991002,-17.208932,-13.851092,-18.188302,-17.908482,-8.254691,-19.167672,-19.447493,-18.048392,-3.357840,-13.851092,-14.410732,-14.550642,-4.896851,-16.649292,-12.871722,-13.291452,-6.995501,-9.653791,-9.373971,-22.805333,-3.917481,-6.295951,-15.530012,-12.871722,-7.695051,-6.995501,-9.094151,-6.295951,-10.213431,-12.731812,5.736311,-9.653791,-4.896851,10.493251,-19.587403,20.007133,-24.204433,14.830462,-22.665423,6.715681,-14.830462,-5.596401,-2.238560,-4.057391,-3.357840,-11.612531,8.814331,-5.176671,4.896851,-13.431362,6.016131,-14.970372,1.678920,-9.234061,4.337211,-9.653791,1.399100,-8.814331,8.114781,-7.834961,6.715681,-11.332711,7.834961,-10.493251,9.373971,-12.032262,10.213431,-11.612531,4.896851,-8.674421,7.695051,-11.052891,3.497750,-6.295951,6.435861,-2.098650,5.316581,-6.575771,6.156041,-8.674421,6.715681,-4.057391,7.695051,-18.048392,11.892352,-7.135411,5.176671,-1.818830,5.456491,-5.316581,-2.098650,-0.699550,-3.357840,0.279820,0.699550,1.958740,-5.736311,3.217930,-3.357840,2.238560,-2.378470,1.259190,3.497750,-4.057391,-5.176671,10.213431,-7.135411,5.736311,0.699550,4.477121,-6.435861,5.456491,-5.316581,2.798200,-8.394601,2.798200,-5.176671,0.139910,3.357840,1.818830,-2.378470,0.139910,-4.197301,5.036761,-3.917481,-1.678920,5.736311,-3.917481,1.958740,-3.217930,1.119280,-1.818830,-3.497750,3.497750,2.238560,1.259190,3.497750,-3.078020,1.259190,-3.917481,2.098650,-0.979370,3.217930,1.119280,0.419730,-0.139910,-1.119280,0.839460,-1.399100,1.818830,-0.559640,0.139910,3.078020,-1.399100,1.539010,-1.259190,1.119280,-0.839460,0.419730,0.699550,-0.559640,0.699550,-0.559640,0.279820,-0.559640,-0.139910,2.938110,0.979370,1.399100,-1.539010,0.839460,1.818830,-3.917481,6.715681,-3.637660,2.658290,1.119280,-1.539010,3.917481,-2.098650,4.197301,-0.979370,-2.938110,0.979370,-0.559640,-0.559640,1.399100,-1.119280,-0.699550,0.979370,-2.098650,0.979370,0.979370,-0.559640,-0.979370,-2.238560,-1.678920,-1.818830,-1.119280,1.958740,-1.958740,0.699550,-0.139910,0.139910,0.139910,-3.637660,0.979370,-0.839460,-0.839460,0.979370,-2.238560,0.000000,-2.378470,2.098650,-2.378470,-2.098650,0.139910,-1.119280,-0.699550,-0.979370,-0.139910,-0.559640,0.139910,-1.119280,-1.259190,0.839460,-1.539010,1.818830,-1.818830,1.119280,0.139910,-0.699550,0.699550,-0.839460,0.139910,-1.259190,0.279820,-1.958740,-0.139910,-0.839460,-0.979370,0.000000,0.139910,0.279820,0.139910,-0.559640,0.000000,0.699550,-0.839460,-0.139910,-1.399100,1.259190,-1.119280,-0.979370,-1.119280,-3.357840,0.000000,-0.559640,0.139910,-0.139910,-0.559640,0.139910,-0.979370,0.419730,0.559640,-0.419730,0.139910,0.279820,-1.958740,0.419730,-0.699550,0.559640,-0.559640,-0.279820,-0.979370,-0.979370,-0.839460,-0.979370,0.000000,0.000000,0.139910,-1.399100,-0.419730,-0.979370,-0.279820,-0.839460,0.279820,0.839460,-0.419730,0.139910,1.678920,-0.699550,-0.139910,-0.279820,-0.699550,0.979370,0.559640,0.979370,0.839460,-0.139910,0.979370,0.279820,0.559640,0.559640,-0.839460,-0.559640,0.000000,-1.399100,-1.259190,-0.839460,-0.699550,-0.139910,-0.559640,-0.139910,0.559640,0.559640,0.419730,0.279820,-0.419730,-0.559640,0.419730,0.000000,0.000000,0.699550,-0.419730,-0.139910,-0.139910,0.139910,0.139910,0.139910,0.559640,0.559640,0.699550,0.699550,0.139910,-0.279820,-1.259190,-2.798200,3.357840,-1.399100,0.979370,1.539010,-2.238560,1.259190,0.839460,0.559640,0.139910,-0.559640,3.637660,-0.699550,0.000000,-2.238560,0.279820,0.979370,-0.699550,-0.559640,-0.559640,-0.279820,0.419730,-0.839460,0.279820,0.559640,-0.279820,0.000000,-0.699550,0.559640,-0.279820,0.279820,0.559640,-1.119280,0.419730,-0.139910,-0.279820,-0.839460,-0.139910,-0.419730,0.000000,-0.839460,-0.139910,0.419730,0.139910,0.559640,-0.839460,-0.419730,-0.279820,-0.559640,0.279820,-0.279820,0.000000,-0.979370,-0.139910,0.000000,0.000000,0.139910,-0.139910,0.000000,-0.419730,0.279820,0.419730,0.000000,0.139910,-1.119280,0.139910,-0.699550,-0.699550,-0.419730,-0.419730};
static float XGE_1885_Y[801]={-0.684152,-0.273661,-0.410491,-0.410491,0.136830,0.000000,-0.410491,0.136830,0.273661,0.000000,0.410491,0.000000,-0.136830,0.000000,0.000000,0.000000,-0.273661,-0.136830,0.136830,0.000000,0.684152,0.136830,0.000000,-0.547322,-0.273661,-0.273661,0.136830,-0.136830,-0.410491,-0.273661,-0.273661,0.136830,0.273661,-0.547322,-0.547322,-0.136830,-0.136830,-0.273661,-0.273661,0.273661,-0.136830,0.000000,-0.136830,0.000000,0.410491,0.136830,-0.410491,-0.136830,0.136830,0.273661,-0.273661,0.000000,-0.136830,-0.136830,-0.547322,-0.410491,0.410491,0.820983,-0.136830,-0.136830,-0.273661,0.273661,0.000000,-0.136830,0.000000,-0.136830,0.136830,-0.136830,-0.547322,-0.410491,0.547322,0.136830,-0.410491,0.410491,0.273661,-0.957813,0.136830,-0.273661,-0.273661,0.000000,0.000000,-0.273661,-0.136830,-0.410491,-0.273661,-0.273661,0.410491,-0.684152,-0.136830,-0.136830,-0.410491,-0.410491,-0.410491,0.136830,0.547322,0.273661,-0.136830,-0.273661,-0.410491,0.136830,0.273661,0.410491,-0.136830,0.000000,-0.136830,0.136830,0.000000,-0.136830,0.273661,-0.410491,-0.136830,-0.136830,-0.136830,-0.273661,-0.273661,-0.136830,0.000000,-0.684152,-0.547322,0.136830,-0.684152,0.136830,0.000000,-0.547322,0.000000,-0.136830,-0.273661,0.410491,-0.136830,0.273661,0.000000,0.136830,0.000000,-0.410491,0.273661,0.000000,0.273661,-0.273661,-0.273661,0.410491,0.000000,0.273661,-0.547322,0.000000,-0.273661,-0.273661,0.000000,0.410491,-0.136830,-0.136830,0.273661,0.136830,-0.547322,0.273661,0.136830,0.000000,0.410491,0.273661,0.410491,0.136830,0.000000,0.273661,0.136830,-0.410491,0.000000,0.410491,0.273661,-0.136830,-0.273661,-0.136830,0.000000,0.273661,0.136830,0.547322,-0.273661,-0.136830,0.000000,-0.136830,0.820983,-0.547322,0.136830,0.547322,0.000000,0.000000,0.547322,0.000000,0.273661,0.136830,0.410491,0.000000,0.000000,0.410491,-0.136830,0.957813,-0.410491,0.547322,0.000000,-0.136830,0.000000,0.273661,0.136830,0.000000,0.000000,0.000000,0.136830,1.231474,1.368304,1.231474,2.052456,1.641965,4.925895,6.431030,-7.115182,3.010269,-10.125451,5.199556,-1.505135,12.177907,5.610047,1.915626,-0.273661,1.778795,7.388843,9.714960,-0.820983,7.525673,10.535942,-8.757147,1.778795,-0.684152,15.872329,1.505135,25.176797,-14.777685,23.124341,-8.483486,2.873439,6.841521,4.241743,12.451568,-15.872329,-0.957813,-10.262281,-7.799334,6.020538,20.935054,34.618096,4.104913,-2.736608,-6.157369,8.893977,14.777685,25.176797,7.662503,13.546211,5.336386,-9.304468,6.567860,11.630586,8.620316,-5.336386,10.672773,1.505135,-18.335276,2.873439,29.281710,36.944213,2.599778,6.704691,-14.230364,-9.578129,2.599778,25.724119,2.052456,9.988621,7.252012,-7.388843,3.968082,-2.462948,7.252012,19.566750,6.567860,23.808493,8.620316,0.820983,2.599778,13.683042,20.387732,0.136830,23.671662,-6.567860,-1.641965,-10.399112,11.220094,5.199556,-6.841521,8.483486,31.881488,9.578129,4.789065,15.461837,6.978351,17.514294,18.335276,-2.189287,28.187066,0.820983,16.145989,9.167638,17.651124,21.619206,-16.830142,2.189287,20.798224,8.893977,14.093533,5.062725,14.914516,-7.388843,28.323897,-6.841521,-1.505135,7.252012,-8.893977,28.187066,5.610047,45.975021,19.840411,9.304468,7.936164,19.019428,4.925895,26.818762,2.052456,26.271440,22.987510,40.638634,28.734388,11.767416,42.417430,15.598668,11.083264,-6.704691,43.375243,6.157369,3.694421,51.037746,3.283930,0.273661,-5.336386,30.786844,23.534832,-12.588399,30.102692,6.704691,10.672773,11.767416,10.262281,12.177907,17.514294,8.757147,22.987510,0.273661,2.462948,26.955592,22.166528,17.924785,-21.482376,27.913405,16.282820,5.062725,39.680821,5.610047,8.893977,22.029697,13.272551,14.230364,12.588399,24.903136,19.156259,12.998890,12.588399,12.177907,14.640855,13.956703,31.470996,13.135720,15.051346,8.072995,21.345545,21.071884,20.935054,18.472107,12.177907,13.409381,16.556481,21.892867,20.387732,11.767416,9.167638,18.745767,20.661393,17.787954,15.325007,13.272551,11.356925,20.114072,13.819872,19.977241,24.903136,23.124341,16.830142,11.767416,17.651124,22.577019,21.619206,15.051346,34.891757,12.862059,18.608937,9.304468,17.103802,14.640855,7.115182,28.050236,5.199556,17.240633,1.094643,31.744657,18.198446,14.914516,16.830142,8.893977,16.966972,12.177907,13.135720,7.525673,10.809603,11.493755,6.294199,7.252012,11.220094,6.704691,12.862059,3.694421,11.356925,4.789065,11.904246,6.294199,9.167638,7.936164,12.862059,11.083264,7.799334,2.599778,6.020538,9.851790,7.525673,6.704691,8.483486,3.968082,7.115182,1.641965,7.662503,-1.231474,-0.273661,6.431030,1.231474,7.525673,1.368304,6.431030,-4.925895,7.115182,1.368304,-6.704691,10.399112,-0.136830,5.062725,-2.462948,-2.326117,2.326117,3.694421,6.431030,-1.778795,6.157369,-3.557591,-1.368304,2.052456,6.294199,4.515404,-3.557591,-3.557591,-1.231474,-1.641965,2.736608,7.799334,6.567860,-6.431030,-2.599778,-0.273661,-3.010269,7.662503,-1.094643,-1.094643,-2.189287,0.820983,4.789065,-7.388843,-0.410491,-1.231474,-0.273661,0.547322,0.410491,3.831252,1.505135,1.368304,-6.431030,-0.820983,-2.736608,3.147100,1.915626,1.368304,1.094643,-2.736608,-0.273661,-3.010269,0.273661,1.915626,1.778795,2.189287,-2.736608,-0.410491,-2.052456,0.273661,0.273661,-0.410491,0.957813,-2.052456,0.273661,-2.873439,-0.410491,-1.915626,-2.736608,-1.094643,-2.326117,0.273661,-0.136830,-0.957813,-0.957813,-2.736608,-0.957813,-3.147100,-0.136830,0.547322,-1.231474,-0.820983,-2.462948,-0.547322,-0.820983,0.820983,-0.547322,-1.231474,-0.957813,-0.957813,-2.599778,-3.010269,1.641965,2.462948,-3.147100,-1.505135,-1.368304,1.094643,0.136830,-1.641965,0.273661,-0.684152,-1.231474,-1.505135,1.505135,0.000000,2.599778,-0.820983,-0.410491,-0.957813,-1.368304,1.368304,0.410491,0.957813,-0.547322,0.547322,1.778795,-0.957813,0.410491,1.505135,2.052456,0.136830,-0.547322,-1.231474,1.368304,-0.957813,-1.094643,-0.410491,0.547322,-0.136830,-0.136830,0.547322,0.547322,-0.136830,0.547322,2.873439,0.136830,1.368304,-0.410491,0.957813,0.547322,-1.094643,-0.410491,-0.410491,2.189287,-1.915626,0.410491,1.094643,0.957813,-1.094643,0.273661,0.684152,2.326117,0.273661,-0.820983,-1.094643,0.136830,-2.189287,0.000000,0.000000,0.136830,-1.231474,-1.231474,0.136830,0.684152,0.000000,0.410491,0.000000,-0.136830,-0.820983,-0.547322,1.641965,0.547322,1.231474,-1.094643,-0.684152,-0.273661,0.684152,-0.684152,0.136830,-0.273661,-0.684152,-1.641965,0.000000,0.684152,1.094643,0.273661,0.273661,-0.684152,-0.273661,-0.684152,1.368304,1.094643,0.684152,-0.820983,-0.410491,0.136830,-0.273661,-0.273661,0.136830,0.273661,-0.957813,-0.820983,-1.641965,0.410491,1.368304,0.684152,0.000000,-0.410491,-0.273661,-1.368304,-1.094643,0.410491,1.641965,1.094643,-0.547322,-1.094643,0.410491,-0.136830,-0.684152,0.000000,0.410491,-0.273661,-0.136830,0.410491,-0.273661,0.410491,-0.820983,-0.684152,0.273661,0.136830,-0.410491,0.684152,0.957813,-0.136830,-0.273661,-0.684152,0.136830,0.273661,0.000000,0.410491,0.273661,0.410491,-0.410491,0.547322,0.820983,0.136830,0.000000,0.273661,0.136830,-0.136830,-0.273661,0.136830,-0.136830,0.957813,0.410491,-0.273661,-3.420760,3.283930,-0.547322,-2.052456,2.462948,0.957813,-0.410491,-2.736608,3.557591,0.957813,-2.052456,1.641965,-0.547322,0.410491,-3.283930,0.547322,0.957813,0.000000,-0.136830,-1.231474,0.957813,-0.820983,0.684152,-0.273661,0.957813,0.000000,0.000000,0.136830,-0.273661,0.000000,-0.136830,0.684152,-0.684152,-0.547322,0.273661,-0.136830,0.273661,0.547322,0.684152,-0.547322,0.000000,0.410491,0.684152,0.273661,0.273661,0.000000,-0.547322,0.136830,-0.410491,0.136830,0.684152,0.820983,0.547322,-0.410491,-0.136830,0.410491,0.136830,1.231474,0.273661,0.136830,-0.547322,0.000000,-0.136830,0.000000,-0.410491,0.547322,-0.273661,0.000000,-0.273661,-0.136830};
static float XGF_FRONT_X[801]={-2.48722432,-2.34092704,-2.19462976,-2.6335216,-2.34092704,-2.48722432,-2.48722432,-2.19462976,-2.34092704,-2.04833248,-2.48722432,-2.19462976,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.19462976,-2.48722432,-2.19462976,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.19462976,-2.6335216,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.19462976,-2.34092704,-2.34092704,-2.34092704,-2.19462976,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.19462976,-2.48722432,-2.19462976,-2.34092704,-2.19462976,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.19462976,-2.34092704,-2.19462976,-2.19462976,-2.34092704,-2.34092704,-2.19462976,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.34092704,-2.48722432,-2.19462976,-2.34092704,-2.34092704,-2.04833248,-2.48722432,-2.48722432,-2.04833248,-2.34092704,-2.48722432,-2.48722432,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.34092704,-2.19462976,-2.48722432,-2.48722432,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.48722432,-2.34092704,-2.19462976,-2.48722432,-2.34092704,-2.19462976,-2.48722432,-2.34092704,-2.34092704,-2.19462976,-2.34092704,-2.19462976,-2.34092704,-2.04833248,-2.19462976,-2.48722432,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.48722432,-2.48722432,-2.19462976,-2.48722432,-2.48722432,-2.34092704,-2.34092704,-2.34092704,-2.19462976,-2.34092704,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.48722432,-2.34092704,-2.19462976,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.48722432,-2.34092704,-2.19462976,-2.34092704,-2.34092704,-2.34092704,-2.19462976,-2.48722432,-2.48722432,-2.34092704,-2.19462976,-2.34092704,-2.48722432,-2.19462976,-2.48722432,-2.48722432,-2.19462976,-2.34092704,-2.34092704,-2.19462976,-2.19462976,-2.48722432,-2.34092704,-2.19462976,-2.34092704,-2.34092704,-2.48722432,-2.19462976,-2.34092704,-2.6335216,-2.04833248,-2.48722432,-2.34092704,-2.04833248,-2.48722432,-2.34092704,-2.19462976,-2.48722432,-2.34092704,-2.34092704,-2.34092704,-2.19462976,-2.34092704,-2.48722432,-2.19462976,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.19462976,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.6335216,-3.07241344,-5.41316992,-13.31322304,-4.24279168,-1.75573792,-8.77800736,-5.41316992,6.72950432,-10.82616928,-17.11695232,6.72950432,-14.77619584,-20.9206816,2.19428864,-15.36138496,-14.92249312,2.63318048,-11.99654752,-14.48360128,-2.34092704,-28.08924832,-4.8279808,51.93536384,-25.60219456,-25.16330272,4.6813424,-27.06516736,-14.04470944,30.42966368,-62.90800096,-36.42819328,6.58320704,-74.02659424,-11.70395296,-8.77800736,-61.1524336,30.57596096,44.76679712,-57.4950016,-36.13559872,-38.76894976,-22.3836544,62.61506528,3.51096416,-58.37278528,-21.94476256,-36.72078784,-37.45227424,-17.994736,-9.9483856,33.50190656,5.99801792,-16.23916864,-10.97246656,-31.45408576,-28.2355456,-7.16873728,-32.624464,-4.8279808,-14.92249312,-49.00975936,-14.77619584,-11.85025024,-39.64673344,-12.58173664,-0.4390624,-15.50768224,20.92034048,24.4314752,-35.40411232,47.98533728,-4.38908896,-34.52632864,3.949856,-27.79665376,-58.51908256,0.43872128,-67.44321664,-57.93389344,-36.281896,-9.2168992,-54.13016416,-40.96340896,-35.25781504,-33.06335584,-5.26687264,-64.8098656,-22.82254624,5.85172064,-33.79484224,-38.76894976,-36.281896,-31.60038304,-37.30597696,-26.18738368,-15.8002768,-39.64673344,-18.28733056,-15.21508768,-10.82616928,-8.33911552,-19.89660064,-7.7539264,-0.00017056,-14.337304,-0.4390624,11.70361184,-16.23916864,-6.43725088,-10.53357472,-39.50043616,-17.55584416,-17.55584416,-24.43181632,-26.47997824,-26.7725728,-20.77438432,-20.1891952,-27.35776192,-29.40592384,-32.33186944,-29.99111296,-21.50587072,-28.2355456,-25.16330272,-22.3836544,-16.67806048,-12.8743312,-8.33911552,-15.8002768,-7.31503456,-10.53357472,-17.55584416,-6.58354816,-11.26506112,-6.58354816,-9.80208832,-6.2909536,-8.19281824,-11.4113584,-15.50768224,-9.36319648,-4.24279168,-4.97427808,-9.07060192,-7.16873728,-0.29276512,-5.12057536,-8.04652096,-6.14465632,-5.99835904,-0.87795424,-1.02425152,-3.95019712,-6.43725088,-3.21871072,-3.07241344,-2.92611616,-2.6335216,-2.04833248,0.14612672,1.60909952,-1.60944064,-5.85206176,1.0239104,-4.38908896,-4.38908896,-5.5594672,-15.21508768,-2.19462976,-0.29276512,-8.04652096,1.0239104,3.36466688,-7.90022368,1.90169408,-6.43725088,-2.48722432,0.43872128,-4.0964944,-4.24279168,-1.75573792,-2.48722432,3.07207232,-1.31684608,-1.46314336,-1.75573792,-3.365008,1.0239104,-1.1705488,-4.97427808,-1.02425152,1.17020768,1.31650496,-0.29276512,2.04799136,0.58501856,-1.02425152,-1.1705488,-2.77981888,-3.07241344,2.4868832,-0.00017056,2.34058592,-1.75573792,-0.87795424,0.73131584,-2.92611616,-1.46314336,-0.29276512,-2.6335216,-2.6335216,-1.60944064,0.292424,-3.07241344,-1.02425152,0.87761312,-1.60944064,-2.77981888,-2.19462976,-2.77981888,-1.9020352,-0.58535968,-2.92611616,-0.87795424,-2.34092704,-4.38908896,-1.60944064,-1.1705488,-1.75573792,1.31650496,-1.02425152,-4.0964944,-1.1705488,-2.34092704,-1.31684608,-2.6335216,-1.31684608,-2.34092704,-2.19462976,-2.04833248,-2.04833248,-0.29276512,-1.31684608,-4.38908896,-2.92611616,-4.97427808,-1.46314336,-3.07241344,-2.6335216,-2.19462976,-3.80389984,-3.07241344,-3.65760256,-3.65760256,-1.1705488,-0.87795424,-3.51130528,-2.92611616,-1.46314336,-2.77981888,-2.77981888,-1.60944064,-3.21871072,-1.46314336,-3.95019712,-2.92611616,-3.07241344,-2.48722432,-2.34092704,-1.46314336,-2.19462976,-2.19462976,-2.48722432,-2.92611616,-2.92611616,-2.77981888,-1.60944064,-0.29276512,-2.19462976,-1.1705488,-1.46314336,-1.46314336,-2.92611616,-2.77981888,-1.02425152,-2.77981888,-1.9020352,-2.77981888,-2.48722432,-2.19462976,-3.07241344,-2.92611616,-1.9020352,-3.21871072,-2.48722432,-1.60944064,-1.31684608,-1.1705488,-1.60944064,-1.1705488,-1.75573792,-1.46314336,-2.04833248,-2.34092704,-3.21871072,-1.46314336,-1.9020352,-1.9020352,-2.77981888,-2.34092704,-2.04833248,-1.9020352,-2.34092704,-2.19462976,-2.04833248,-1.60944064,-1.60944064,-2.48722432,-1.1705488,-3.21871072,-2.92611616,-2.04833248,-3.07241344,-3.07241344,-2.6335216,-2.34092704,-1.60944064,-1.60944064,-2.92611616,-2.04833248,-1.60944064,-2.48722432,-2.34092704,-2.04833248,-1.31684608,-2.92611616,-3.65760256,-2.6335216,-2.48722432,-2.77981888,-2.19462976,-2.48722432,-1.9020352,-1.9020352,-1.60944064,-1.9020352,-1.46314336,-2.19462976,-2.34092704,-2.48722432,-3.365008,-1.9020352,-2.04833248,-2.04833248,-2.04833248,-2.19462976,-2.48722432,-3.07241344,-1.9020352,-1.9020352,-1.60944064,-0.29276512,-3.365008,-1.46314336,-1.46314336,-3.07241344,-2.04833248,-2.04833248,-1.75573792,-1.9020352,-1.9020352,-1.75573792,-1.9020352,-2.34092704,-2.92611616,-1.9020352,-1.60944064,-1.02425152,-3.51130528,-2.6335216,-2.77981888,-1.60944064,-1.31684608,-1.46314336,-3.07241344,-1.9020352,-1.46314336,-2.6335216,-1.75573792,-2.19462976,-1.60944064,-2.04833248,-2.34092704,-1.9020352,-2.48722432,-2.6335216,-1.46314336,-2.04833248,-1.9020352,-2.34092704,-2.77981888,-2.04833248,-2.19462976,-2.19462976,-2.34092704,-2.48722432,-2.48722432,-2.19462976,-2.48722432,-2.48722432,-2.04833248,-1.9020352,-2.19462976,-2.04833248,-2.04833248,-2.34092704,-2.19462976,-2.6335216,-2.92611616,-3.07241344,-2.04833248,-2.34092704,-2.77981888,-2.6335216,-2.92611616,-2.19462976,-1.9020352,-2.92611616,-2.34092704,-2.77981888,-3.07241344,-2.48722432,-2.77981888,-2.34092704,-2.19462976,-2.48722432,-2.77981888,-2.34092704,-2.48722432,-2.77981888,-2.77981888,-2.48722432,-2.6335216,-2.34092704,-2.19462976,-2.48722432,-2.19462976,-1.9020352,-2.48722432,-2.19462976,-2.34092704,-2.04833248,-2.04833248,-1.9020352,-2.48722432,-2.34092704,-2.77981888,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.19462976,-2.77981888,-2.6335216,-2.77981888,-2.48722432,-2.6335216,-2.48722432,-2.48722432,-2.19462976,-2.19462976,-2.34092704,-2.48722432,-2.48722432,-2.48722432,-2.04833248,-2.48722432,-2.48722432,-2.48722432,-2.34092704,-2.34092704,-2.48722432,-2.6335216,-2.6335216,-2.19462976,-2.34092704,-2.48722432,-2.34092704,-1.9020352,-2.04833248,-2.19462976,-2.19462976,-2.19462976,-2.19462976,-2.48722432,-2.48722432,-2.6335216,-2.48722432,-2.34092704,-2.6335216,-2.6335216,-2.34092704,-2.48722432,-2.77981888,-2.6335216,-2.6335216,-2.6335216,-2.77981888,-2.34092704,-2.6335216,-2.34092704,-2.77981888,-2.6335216,-2.6335216,-2.6335216,-2.6335216,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.48722432,-2.48722432,-2.34092704,-2.48722432,-2.04833248,-2.04833248,-2.19462976,-2.34092704,-2.48722432,-2.48722432,-2.48722432,-2.48722432,-2.48722432,-2.34092704,-2.34092704,-2.34092704,-2.34092704,-2.48722432,-2.34092704,-2.48722432,-2.92611616,-2.34092704,-2.48722432,-2.04833248,-2.04833248,-2.34092704,-2.34092704,-2.48722432,-2.48722432,-2.48722432,-2.48722432,-2.19462976,-2.19462976,-2.19462976,-2.34092704,-2.48722432,-2.48722432,-2.34092704,-2.34092704,-2.04833248,-2.34092704,-2.19462976,-2.48722432,-2.48722432,-2.48722432,-2.6335216,-2.34092704,-2.77981888,-2.34092704,-2.77981888,-2.34092704,-2.19462976,-2.19462976,-2.48722432,-2.48722432,-2.48722432,-2.19462976,-2.34092704,-2.48722432,-2.48722432,-2.48722432,-2.19462976,-2.34092704,-2.04833248,-2.48722432,-2.48722432,-2.6335216,-2.6335216,-2.48722432,-2.48722432,-2.34092704,-2.19462976,-2.19462976,-2.48722432,-2.34092704};
static float XGF_FRONT_Y[801]={-0.58328928,-0.87490592,-1.02071424,-0.58328928,-0.72909760,-0.72909760,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.87490592,-0.58328928,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.58328928,-0.43748096,-0.43748096,-0.87490592,-0.43748096,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.43748096,-0.87490592,-0.72909760,-0.87490592,-0.72909760,-0.43748096,-0.87490592,-0.72909760,-0.72909760,-0.72909760,-0.72909760,-0.43748096,-0.87490592,-0.72909760,-0.58328928,-0.58328928,-0.58328928,-0.72909760,-0.58328928,-0.58328928,-0.72909760,-0.58328928,-0.58328928,-0.87490592,-0.58328928,-0.72909760,-0.72909760,-0.43748096,-0.72909760,-0.58328928,-0.72909760,-0.58328928,-0.72909760,-0.87490592,-0.72909760,-0.72909760,-0.58328928,-0.58328928,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.58328928,-0.87490592,-0.43748096,-0.87490592,-0.58328928,-0.72909760,-0.87490592,-0.72909760,-0.72909760,-0.87490592,-0.72909760,-0.72909760,-0.72909760,-0.58328928,-0.87490592,-0.72909760,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.72909760,-0.58328928,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.72909760,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.58328928,-0.72909760,-0.58328928,-0.87490592,-0.72909760,-0.29167264,-0.87490592,-0.87490592,-0.58328928,-0.72909760,-0.72909760,-0.43748096,-0.87490592,-0.58328928,-0.43748096,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.58328928,-0.58328928,-0.72909760,-0.58328928,-0.72909760,-0.58328928,-0.43748096,-0.72909760,-0.72909760,-0.58328928,-0.58328928,-0.72909760,-0.58328928,-0.87490592,-0.43748096,-0.72909760,-0.72909760,-0.58328928,-0.87490592,-0.43748096,-0.58328928,-0.58328928,-0.58328928,-0.72909760,-0.72909760,-0.87490592,-0.43748096,-0.87490592,-0.72909760,-0.43748096,-0.72909760,-0.72909760,-0.58328928,-0.72909760,-0.87490592,-0.58328928,-0.72909760,-0.72909760,-0.43748096,-1.02071424,-0.58328928,-0.87490592,-0.87490592,-0.43748096,-0.87490592,-0.72909760,-0.58328928,-0.87490592,-0.58328928,-0.58328928,-0.87490592,-0.58328928,-0.87490592,-0.58328928,-0.58328928,-0.72909760,-0.43748096,-0.87490592,-0.72909760,-0.43748096,-0.87490592,-0.72909760,-0.29167264,-0.87490592,-0.58328928,-0.58328928,-0.87490592,-0.58328928,-0.72909760,-0.58328928,-0.72909760,-0.72909760,-0.72909760,-0.58328928,-0.43748096,-0.87490592,-0.58328928,-0.43748096,0.29156064,3.79096032,13.26850112,-0.43748096,5.97808512,3.93676864,-6.70723872,-7.43628032,8.16520992,17.05951744,-14.72669632,24.34993344,16.62209248,-7.58208864,15.16400928,22.60023360,-3.79107232,14.58077600,16.47628416,22.16280864,34.41070752,-2.18718080,-29.45333664,36.88944896,-4.66592224,-16.33058784,13.41430944,11.51880128,30.18226624,80.48613664,35.28555744,17.78855904,36.88944896,23.18346688,-9.33178848,26.68286656,37.18106560,-40.38896064,63.42656320,14.58077600,34.26489920,31.20292448,-3.93688064,52.63674752,57.74003872,10.93556800,2.47868544,1.16641056,-12.53957152,50.59543104,43.45082336,7.14455168,16.62209248,-3.93688064,53.36578912,20.70472544,19.39245056,57.15680544,24.49574176,56.13614720,22.01700032,12.97688448,14.87239264,52.19932256,-5.24915552,14.87239264,21.57957536,41.84693184,-21.57968736,-4.95753888,-15.89316288,7.58197664,36.01459904,-41.84704384,37.03525728,21.28795872,43.45082336,15.30981760,-19.39256256,76.98673696,5.10323520,87.04751104,19.68406720,19.97568384,38.49334048,-18.80932928,21.28795872,12.24784288,33.53585760,-5.39496384,6.70712672,17.49694240,23.76670016,37.76429888,36.74364064,1.60383552,36.59783232,3.79096032,15.60143424,20.99634208,15.16400928,15.45562592,30.18226624,1.31221888,28.28675808,19.68406720,20.55891712,32.95262432,27.26609984,7.43616832,29.30741632,24.49574176,21.28795872,29.16160800,10.78975968,20.55891712,8.60263488,21.14215040,12.10203456,10.20652640,3.35353536,4.37419360,9.91490976,8.89425152,12.53945952,-5.24915552,22.30861696,8.60263488,13.70592608,1.31221888,2.91611040,12.68526784,-2.04137248,5.83227680,-3.49945568,7.14455168,9.62329312,6.56131840,5.54066016,-2.91622240,3.20772704,6.41551008,-1.31233088,4.52000192,-2.62460576,5.68646848,7.58197664,-0.72909760,9.91490976,-3.20783904,8.16520992,4.37419360,-1.60394752,4.95742688,-3.35364736,6.85293504,2.62449376,0.29156064,4.95742688,-4.37430560,12.97688448,-0.72909760,-1.45813920,0.14575232,-0.87490592,6.70712672,-0.00005600,-1.60394752,1.60383552,-3.20783904,1.02060224,4.08257696,-1.74975584,1.74964384,0.72898560,1.16641056,-0.43748096,0.87479392,-3.79107232,2.33287712,-2.47879744,2.33287712,2.91611040,-3.35364736,2.62449376,-0.72909760,-2.47879744,-1.02071424,1.74964384,-4.22849728,1.60383552,-1.31233088,-6.85304704,-0.14586432,-6.41562208,0.29156064,-5.97819712,-3.06203072,-1.45813920,-8.16532192,0.87479392,-4.95753888,1.74964384,-2.33298912,0.58317728,0.72898560,-2.91622240,0.58317728,0.87479392,2.04126048,-1.74975584,-0.43748096,-3.35364736,0.14575232,-1.16652256,-1.74975584,-1.16652256,0.14575232,-2.04137248,-3.79107232,-0.87490592,-2.91622240,1.16641056,-1.89556416,-1.02071424,-3.93688064,0.14575232,-1.02071424,-1.74975584,2.62449376,-0.87490592,-1.74975584,2.33287712,-3.49945568,-0.29167264,0.43736896,-2.04137248,0.29156064,0.72898560,2.04126048,-2.18718080,2.04126048,0.29156064,1.74964384,-1.02071424,-1.02071424,-2.18718080,-0.43748096,1.31221888,1.60383552,-0.87490592,1.60383552,-1.60394752,-0.43748096,-0.29167264,-0.14586432,0.87479392,-0.29167264,0.43736896,-1.60394752,-0.00005600,-0.87490592,-2.33298912,-0.00005600,-1.89556416,-0.00005600,-0.72909760,-0.43748096,1.45802720,1.02060224,0.29156064,0.58317728,1.16641056,-0.72909760,-0.43748096,-1.31233088,0.14575232,-0.58328928,-1.31233088,-1.02071424,0.29156064,-0.72909760,-2.04137248,-0.00005600,-1.02071424,-0.72909760,-1.02071424,-1.31233088,-1.60394752,-0.00005600,-0.72909760,-0.87490592,-1.89556416,-1.45813920,-1.02071424,-1.16652256,-0.00005600,-2.04137248,-0.58328928,-0.43748096,-1.31233088,-1.60394752,-2.77041408,-1.45813920,-1.31233088,-1.60394752,-1.74975584,-0.72909760,-1.31233088,-1.16652256,-0.43748096,-0.43748096,-0.00005600,-1.45813920,0.58317728,1.16641056,0.14575232,-0.72909760,0.58317728,0.72898560,-1.16652256,-0.58328928,-2.18718080,0.29156064,-1.16652256,-2.04137248,0.14575232,-0.43748096,-0.29167264,-0.58328928,-1.02071424,0.58317728,-0.14586432,0.14575232,-0.29167264,-0.87490592,-0.87490592,-0.87490592,-0.87490592,-0.72909760,-0.00005600,-0.29167264,0.58317728,0.87479392,0.14575232,0.72898560,-1.02071424,0.58317728,0.14575232,-1.60394752,-1.02071424,-0.58328928,-0.14586432,-0.29167264,-0.29167264,0.14575232,-0.43748096,0.58317728,-0.72909760,-1.45813920,1.02060224,-0.14586432,-0.14586432,-0.72909760,-0.58328928,-1.89556416,-0.00005600,-1.60394752,-0.72909760,-0.14586432,-0.72909760,0.14575232,-0.14586432,0.29156064,0.14575232,-0.72909760,-0.00005600,-0.72909760,-0.29167264,-0.87490592,-1.60394752,-0.87490592,0.14575232,-0.72909760,-0.43748096,-1.45813920,-0.58328928,-1.45813920,-0.87490592,-0.87490592,-0.29167264,-0.00005600,-0.87490592,-0.72909760,-0.87490592,-0.58328928,-0.29167264,-0.72909760,-0.43748096,-0.29167264,-0.72909760,-0.00005600,-0.29167264,0.14575232,-0.14586432,-0.00005600,-0.43748096,-0.00005600,-0.87490592,-0.14586432,-0.29167264,-0.29167264,-0.29167264,0.29156064,-0.00005600,0.29156064,0.14575232,-0.72909760,-0.14586432,-0.43748096,-0.29167264,-0.72909760,-0.14586432,-0.00005600,-0.58328928,-0.87490592,-0.43748096,-1.02071424,-0.29167264,-0.72909760,-0.00005600,-0.58328928,-0.58328928,0.29156064,0.14575232,-0.43748096,-0.72909760,-0.29167264,-0.72909760,-0.29167264,-0.58328928,-0.58328928,-1.02071424,-0.87490592,-0.14586432,-0.72909760,-0.29167264,-0.43748096,-0.87490592,-0.14586432,-0.87490592,-0.72909760,-0.43748096,-0.72909760,-0.43748096,-0.58328928,-0.72909760,-0.72909760,-0.29167264,-0.43748096,-0.14586432,-0.43748096,-0.72909760,-0.43748096,-0.14586432,-0.58328928,-0.87490592,-0.87490592,-0.72909760,-0.72909760,-0.58328928,-0.87490592,-0.43748096,-0.72909760,-0.43748096,-0.58328928,-0.58328928,-0.43748096,-0.58328928,-0.43748096,-0.29167264,-0.29167264,-0.29167264,-0.72909760,-0.43748096,-0.58328928,-0.43748096,-0.58328928,-0.14586432,-0.29167264,-0.58328928,-0.29167264,-0.14586432,-0.14586432,-0.72909760,-0.72909760,-0.43748096,-0.58328928,-0.43748096,-0.58328928,-0.58328928,-0.29167264,-0.58328928,-0.43748096,-0.72909760,-0.43748096,-0.43748096,-0.43748096,-0.58328928,-0.72909760,-0.43748096,-0.43748096,-0.43748096,-0.72909760,-0.87490592,-0.72909760,-0.43748096,-0.00005600,-0.00005600,-0.58328928,-0.00005600,-0.29167264,-0.43748096,-0.43748096,-0.58328928,-0.29167264,-0.58328928,-0.29167264,-0.87490592,-0.58328928,-0.87490592,-0.87490592,-0.58328928,-0.58328928,-0.43748096,-0.58328928,-0.72909760,-0.58328928,-0.43748096,-0.58328928,-0.72909760,-1.02071424,-0.87490592,-0.87490592,-0.29167264,-0.72909760,-0.58328928,-0.43748096,-0.58328928,-0.29167264,-0.87490592,-1.02071424,-0.72909760,-0.43748096,-0.43748096,-0.87490592,-0.43748096,-0.43748096,-0.72909760,-0.72909760,-0.72909760,-0.43748096,-0.87490592,-0.72909760,-0.87490592,-0.58328928,-0.43748096,-0.72909760,-0.72909760,-0.72909760,-1.16652256,-0.58328928,-0.87490592,-0.43748096,-0.72909760,-0.87490592,-0.58328928,-0.58328928,-0.58328928,-0.87490592,-0.58328928,-0.72909760,-0.72909760,-0.43748096,-0.72909760,-0.43748096,-1.02071424,-1.02071424,-0.72909760,-0.87490592,-0.72909760,-0.87490592,-0.72909760,-0.29167264,-0.58328928,-0.72909760};	
const uint8_t Request0x0cmd[]={0x10,0x00,0x00,0x0d};
const uint8_t Request0x2cmd[]={0x50,0x00,0x00,0xfc};
volatile double timeX=-100.5,timeY=-100.5;
uint8_t RCOMMAND0x00=0b10000100;
uint8_t RCOMMAND0x02=0b10100100;
uint32_t ctr2=0;
uint32_t ctr0=0;
uint32_t TTF;
volatile bool CRASH_OCCURED_FLAG=false;
/*Flags which are used to track Crashdetected signal state in accelerometer tests*/
volatile bool CRASH_DETECTED_BEFORE_COLLISION_TAKEN=false;
volatile bool CRASH_DETECTED_AFTER_COLLISION_TAKEN=false;
/*----------------------------------------------------------*/
extern TestData Output, Input,Debug;


uint8_t Result[512];
/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_FDCAN1_Init(void);
static void MX_UART4_Init(void);
static void MX_TIM1_Init(void);
static void MX_SPI3_Init(void);
static void MX_RTC_Init(void);
void Init_test_run(void *argument);
void CAN_2_RUN(void *argument);
void Accelerometer1_RUN(void *argument);

/* USER CODE BEGIN PFP */
static void FDCAN1_Config(void);
static uint32_t buffer_average_value(uint32_t *buffer_to_evaluate,uint8_t size);
static uint8_t CRC8(uint32_t SPI_data);
static uint32_t form_acc(float acceleration,bool axis);

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */
void HAL_SPI_TxRxCpltCallback(SPI_HandleTypeDef *hspi)
{
  if(hspi == &hspi3)
  {
    float *acceleration_X_ptr,*acceleration_Y_ptr;
    if(Input.accDataNumber==0x01)
    {
      acceleration_X_ptr=XGE_1885_X;
      acceleration_Y_ptr=XGE_1885_Y;
    }
    else if(Input.accDataNumber==0x02)
    {
      acceleration_X_ptr=XGF_FRONT_X;
      acceleration_Y_ptr=XGF_FRONT_Y;
    }
    else if(Input.accDataNumber==0x03)
    {
      acceleration_X_ptr=XGE_1882_X;
      acceleration_Y_ptr=XGE_1882_Y;
    }
    else if(Input.accDataNumber==0x04)
    {
      acceleration_X_ptr=XGE_1883_X;
      acceleration_Y_ptr=XGE_1883_Y;
    }
    uint32_t acceleration_32;
    if(memcmp(SPI_RXbuf,Request0x0cmd,4)==0)
    { 
       acceleration_32=form_acc(*(acceleration_X_ptr+ctr0),X);
       timeX+=0.5;
       SPI_resp[0]=acceleration_32>>24;
       SPI_resp[1]=acceleration_32>>16;
       SPI_resp[2]=acceleration_32>>8;
       SPI_resp[3]=acceleration_32;
       ctr0+=1;
    }
    else if (memcmp(SPI_RXbuf,Request0x2cmd,4)==0)
    { 
       acceleration_32=form_acc(*(acceleration_Y_ptr+ctr2),Y);
       timeY+=0.5;
       SPI_resp[0]=acceleration_32>>24;
       SPI_resp[1]=acceleration_32>>16;
       SPI_resp[2]=acceleration_32>>8;
       SPI_resp[3]=acceleration_32;    
       ctr2+=1;		 
    }
  }
}
void HAL_FDCAN_RxFifo0Callback(FDCAN_HandleTypeDef *hfdcan, uint32_t RxFifo0ITs)
{
  uint8_t CANRxData[8]={0,};
  uint32_t measured_period;
  if((RxFifo0ITs & FDCAN_IT_RX_FIFO0_NEW_MESSAGE) != RESET)
  {
   HAL_GPIO_TogglePin(RED_LED_GPIO_Port,RED_LED_Pin);
/*implementation for the first test which measures the launching time measures and transmits the time between 
        reception of the UART command to launch test and first received CAN message*/
    if(Input.testNumber==0x11)
    {  	   			
       if (HAL_FDCAN_GetRxMessage(hfdcan, FDCAN_RX_FIFO0, &RxHeader, CANRxData) == HAL_OK)
       { 
        store_CANframeRX(0,CANRxData,RxHeader.DataLength>>16);
        Output.testNumber=Input.testNumber;
        Input.testNumber=0;           
        Output.measuredValue[0]=time;
        Output.measuredValue_count++;           
        Send_Result();
        FDCAN_DISABLE_INTERRUPTS();
       }						 
    }
/*There is the implementation of a test, which measures the period of 0x653 and 0x23 CAN message.
  Those message is being received 50 times, time interval between two consequent messages is being measured every time
  then the average period is being calculated and transmitted via UART*/
//-------------------------------------Select id to measure-----------------------------//		
    else if(Input.testNumber==0x12||Input.testNumber==0x13)
    {
     Output.testNumber=Input.testNumber;
     Output.testNumber=0;        
	 uint32_t ID;
	 if(Input.testNumber==0x12)
	 {
	  ID=0x653;
	 }
	 else
     {
	  ID=0x023;
     }
//---------------------------------------Measurement-------------------------------------//		
	 static uint8_t RXcounter=0;
	 if (HAL_FDCAN_GetRxMessage(hfdcan, FDCAN_RX_FIFO0, &RxHeader, CANRxData) == HAL_OK &&RxHeader.Identifier==ID)
     {
       timelist[RXcounter]=time*2;
       RXcounter++; 
       time=0;    				 
     }
     if(RXcounter==10)
	 {
      store_CANframeRX(0,CANRxData,RxHeader.DataLength>>16);
	 }
     if(RXcounter==20)
	 {
      store_CANframeRX(1,CANRxData,RxHeader.DataLength>>16);
	 }
     if(RXcounter==30)
	 {
      store_CANframeRX(2,CANRxData,RxHeader.DataLength>>16);	 
	 }
     if(RXcounter==40)
	 {
      store_CANframeRX(3,CANRxData,RxHeader.DataLength>>16);
     }	
	 if(RXcounter==50)
	 { 
      timelist[0]=timelist[5]; //
      measured_period=buffer_average_value(timelist,50);
      Output.measuredValue[0]=measured_period;
      Output.measuredValue_count++;	   
      Output.has_accDataNumber=Input.has_accDataNumber;
      Output.accDataNumber=Input.accDataNumber;
      store_CANframeRX(4,CANRxData,RxHeader.DataLength>>16);
      Send_Result();
      RXcounter=0;
      Accelerometer_reset();           						 
	 }				
    }
/*Part which tracks state of CrashDetected signal from 0x653 frame */
    else if(Input.testNumber==0x22)
	{		
	 if(timeX>-98&&CRASH_DETECTED_BEFORE_COLLISION_TAKEN==false)
	 {
      HAL_FDCAN_GetRxMessage(hfdcan, FDCAN_RX_FIFO0, &RxHeader, CANRxData);		 
      store_CANframeRX(0,CANRxData,RxHeader.DataLength>>16);
      CRASH_DETECTED_BEFORE_COLLISION_TAKEN=true;
     }
     if(timeX>0&&CRASH_DETECTED_AFTER_COLLISION_TAKEN==false)
     {
      HAL_FDCAN_GetRxMessage(hfdcan, FDCAN_RX_FIFO0, &RxHeader, CANRxData);	 
      store_CANframeRX(0,CANRxData,RxHeader.DataLength>>16);
      CRASH_DETECTED_AFTER_COLLISION_TAKEN=true;
     }    						
	}						 
  }
 else __NOP();
}

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
/*Handles rising edge interrupt(when crash occurs)*/
  if(GPIO_Pin==CH4_Pin || GPIO_Pin==CH2_Pin)//
  {			
   HAL_GPIO_WritePin(POWER_GOOD_GPIO_Port,POWER_GOOD_Pin,GPIO_PIN_RESET);
   CRASH_OCCURED_FLAG=true;
   TTF=time*2;
   Output.measuredValue[0]=TTF;
   FDCAN_DISABLE_INTERRUPTS(); 		
  }
}

/* USER CODE END 0 */


int main(void)
{
  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_FDCAN1_Init();
  MX_UART4_Init();
  MX_TIM1_Init();
  MX_SPI3_Init();
  MX_RTC_Init();
  /* USER CODE BEGIN 2 */
  FDCAN1_Config();
	HAL_TIM_Base_Start_IT(&htim1);
  /* USER CODE END 2 */

  /* Init scheduler */
  osKernelInitialize();

  /* USER CODE BEGIN RTOS_MUTEX */
  /* add mutexes, ... */
  /* USER CODE END RTOS_MUTEX */

  /* USER CODE BEGIN RTOS_SEMAPHORES */
  /* add semaphores, ... */
  /* USER CODE END RTOS_SEMAPHORES */

  /* USER CODE BEGIN RTOS_TIMERS */
  /* start timers, add new ones, ... */
  /* USER CODE END RTOS_TIMERS */

  /* USER CODE BEGIN RTOS_QUEUES */
  /* add queues, ... */
  /* USER CODE END RTOS_QUEUES */

  /* Create the thread(s) */
  Init_testHandle = osThreadNew(Init_test_run, NULL, &Init_test_attributes);

  CAN_periodHandle = osThreadNew(CAN_2_RUN, NULL, &CAN_period_attributes);

  Accelerometer_runHandle = osThreadNew(Accelerometer1_RUN, NULL, &Accelerometer_run_attributes);
	
  Accelerometer_periodHandle = osThreadNew(Accelerometer_period_RUN, NULL, &Accelerometer_period_attributes);
	
  Send_periodicHandle = osThreadNew(Send_periodic_start, NULL, &Send_periodic_attributes);
	
  SBR1Handle = osThreadNew(SBR1_RUN, NULL, &SBR1_attributes);
	
  SBR2Handle = osThreadNew(SBR2_RUN, NULL, &SBR2_attributes);
	
  SBR3_4Handle = osThreadNew(SBR3_4_RUN, NULL, &SBR3_4_attributes);
   
  SBR5Handle = osThreadNew(SBR5_RUN, NULL, &SBR5_attributes);
	
  SBR6Handle = osThreadNew(SBR6_RUN, NULL, &SBR6_attributes);
	
  SBR7Handle = osThreadNew(SBR7_RUN, NULL, &SBR7_attributes);
	
  EDRHandle = osThreadNew(EDR_Transmitter, NULL, &EDR_attributes);
		
  UDS1Handle = osThreadNew(UDS1_RUN, NULL, &UDS1_attributes);
	
  UDS2Handle = osThreadNew(UDS2_RUN, NULL, &UDS2_attributes);
	
  UDS3Handle = osThreadNew(UDS3_RUN, NULL, &UDS3_attributes);
  
  UDS4aHandle = osThreadNew(UDS4a_RUN, NULL, &UDS4a_attributes);
  
  UDS4bHandle = osThreadNew(UDS4b_RUN, NULL, &UDS4b_attributes);
	
  UDS5Handle = osThreadNew(UDS5_RUN, NULL, &UDS5_attributes);
	
  UDS6Handle = osThreadNew(UDS6_RUN, NULL, &UDS6_attributes);
  
  UDS8Handle = osThreadNew(UDS8_RUN, NULL, &UDS8_attributes);
  
  UDS9Handle = osThreadNew(UDS9_RUN, NULL, &UDS9_attributes);
  
  UDS10Handle = osThreadNew(UDS10_RUN, NULL, &UDS10_attributes);
 
  UDS11_12_13_14_16Handle = osThreadNew(UDS11_12_13_14_16RUN, NULL, &UDS11_12_13_14_16_attributes);
  
  UDS15Handle = osThreadNew(UDS15_RUN, NULL, &UDS15_attributes);
	
 
  
  //DIAG10Handle = osThreadNew(DIAG10_RUN, NULL, &DIAG10_attributes);
  /* USER CODE BEGIN RTOS_THREADS */
  /* add threads, ... */
  /* USER CODE END RTOS_THREADS */

  /* USER CODE BEGIN RTOS_EVENTS */
  /* add events, ... */
  /* USER CODE END RTOS_EVENTS */

  /* Start scheduler */
  osKernelStart();

  /* We should never get here as control is now taken by the scheduler */
  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
}


void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};


  HAL_PWREx_ConfigSupply(PWR_LDO_SUPPLY);

 
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);

  while(!__HAL_PWR_GET_FLAG(PWR_FLAG_VOSRDY)) {}

  __HAL_RCC_SYSCFG_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE0);

  while(!__HAL_PWR_GET_FLAG(PWR_FLAG_VOSRDY)) {}

 
  HAL_PWR_EnableBkUpAccess();
  __HAL_RCC_LSEDRIVE_CONFIG(RCC_LSEDRIVE_LOW);

  
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI|RCC_OSCILLATORTYPE_LSE;
  RCC_OscInitStruct.LSEState = RCC_LSE_ON;
  RCC_OscInitStruct.HSIState = RCC_HSI_DIV1;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSI;
  RCC_OscInitStruct.PLL.PLLM = 4;
  RCC_OscInitStruct.PLL.PLLN = 60;
  RCC_OscInitStruct.PLL.PLLP = 2;
  RCC_OscInitStruct.PLL.PLLQ = 8;
  RCC_OscInitStruct.PLL.PLLR = 2;
  RCC_OscInitStruct.PLL.PLLRGE = RCC_PLL1VCIRANGE_3;
  RCC_OscInitStruct.PLL.PLLVCOSEL = RCC_PLL1VCOWIDE;
  RCC_OscInitStruct.PLL.PLLFRACN = 0;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2
                              |RCC_CLOCKTYPE_D3PCLK1|RCC_CLOCKTYPE_D1PCLK1;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;
  RCC_ClkInitStruct.SYSCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_HCLK_DIV2;
  RCC_ClkInitStruct.APB3CLKDivider = RCC_APB3_DIV2;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_APB1_DIV2;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_APB2_DIV2;
  RCC_ClkInitStruct.APB4CLKDivider = RCC_APB4_DIV2;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_4) != HAL_OK)
  {
    Error_Handler();
  }
}


static void MX_FDCAN1_Init(void)
{

  /* USER CODE BEGIN FDCAN1_Init 0 */

  /* USER CODE END FDCAN1_Init 0 */

  /* USER CODE BEGIN FDCAN1_Init 1 */

  /* USER CODE END FDCAN1_Init 1 */
  hfdcan1.Instance = FDCAN1;
  hfdcan1.Init.FrameFormat = FDCAN_FRAME_CLASSIC;
  hfdcan1.Init.Mode = FDCAN_MODE_NORMAL;
  hfdcan1.Init.AutoRetransmission = ENABLE;
  hfdcan1.Init.TransmitPause = DISABLE;
  hfdcan1.Init.ProtocolException = DISABLE;
  hfdcan1.Init.NominalPrescaler = 15;
  hfdcan1.Init.NominalSyncJumpWidth = 1;
  hfdcan1.Init.NominalTimeSeg1 = 13;
  hfdcan1.Init.NominalTimeSeg2 = 2;
  hfdcan1.Init.DataPrescaler = 1;
  hfdcan1.Init.DataSyncJumpWidth = 1;
  hfdcan1.Init.DataTimeSeg1 = 1;
  hfdcan1.Init.DataTimeSeg2 = 1;
  hfdcan1.Init.MessageRAMOffset = 0;
  hfdcan1.Init.StdFiltersNbr = 3;
  hfdcan1.Init.ExtFiltersNbr = 0;
  hfdcan1.Init.RxFifo0ElmtsNbr = 64;
  hfdcan1.Init.RxFifo0ElmtSize = FDCAN_DATA_BYTES_8;
  hfdcan1.Init.RxFifo1ElmtsNbr = 64;
  hfdcan1.Init.RxFifo1ElmtSize = FDCAN_DATA_BYTES_8;
  hfdcan1.Init.RxBuffersNbr = 0;
  hfdcan1.Init.RxBufferSize = FDCAN_DATA_BYTES_8;
  hfdcan1.Init.TxEventsNbr = 0;
  hfdcan1.Init.TxBuffersNbr = 1;
  hfdcan1.Init.TxFifoQueueElmtsNbr = 32;
  hfdcan1.Init.TxFifoQueueMode = FDCAN_TX_FIFO_OPERATION;
  hfdcan1.Init.TxElmtSize = FDCAN_DATA_BYTES_8;
  if (HAL_FDCAN_Init(&hfdcan1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN FDCAN1_Init 2 */
  HAL_FDCAN_ConfigTimestampCounter(&hfdcan1,1);
  FDCAN1->TSCC |=0x01;//set internal clock source for timestamp
  FDCAN1->RXF0C|=1<<31;//set RXFIFO0 overwrite mode
  FDCAN1->RXF1C|=1<<31;//set RXFIFO1 overwrite mode
  /* USER CODE END FDCAN1_Init 2 */

}


static void MX_RTC_Init(void)
{

  /* USER CODE BEGIN RTC_Init 0 */

  /* USER CODE END RTC_Init 0 */

  RTC_TimeTypeDef sTime = {0};
  RTC_DateTypeDef sDate = {0};

  /* USER CODE BEGIN RTC_Init 1 */

  /* USER CODE END RTC_Init 1 */

  /** Initialize RTC Only
  */
  hrtc.Instance = RTC;
  hrtc.Init.HourFormat = RTC_HOURFORMAT_24;
  hrtc.Init.AsynchPrediv = 127;
  hrtc.Init.SynchPrediv = 255;
  hrtc.Init.OutPut = RTC_OUTPUT_DISABLE;
  hrtc.Init.OutPutPolarity = RTC_OUTPUT_POLARITY_HIGH;
  hrtc.Init.OutPutType = RTC_OUTPUT_TYPE_OPENDRAIN;
  hrtc.Init.OutPutRemap = RTC_OUTPUT_REMAP_NONE;
  if (HAL_RTC_Init(&hrtc) != HAL_OK)
  {
    Error_Handler();
  }

  /* USER CODE BEGIN Check_RTC_BKUP */

  /* USER CODE END Check_RTC_BKUP */

  /** Initialize RTC and set the Time and Date
  */
  sTime.Hours = 0x16;
  sTime.Minutes = 0x0;
  sTime.Seconds = 0x0;
  sTime.DayLightSaving = RTC_DAYLIGHTSAVING_NONE;
  sTime.StoreOperation = RTC_STOREOPERATION_RESET;
  if (HAL_RTC_SetTime(&hrtc, &sTime, RTC_FORMAT_BCD) != HAL_OK)
  {
    Error_Handler();
  }
  sDate.WeekDay = RTC_WEEKDAY_SATURDAY;
  sDate.Month = RTC_MONTH_APRIL;
  sDate.Date = 0x6;
  sDate.Year = 0x24;

  if (HAL_RTC_SetDate(&hrtc, &sDate, RTC_FORMAT_BCD) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN RTC_Init 2 */

  /* USER CODE END RTC_Init 2 */

}


static void MX_SPI3_Init(void)
{

  /* USER CODE BEGIN SPI3_Init 0 */

  /* USER CODE END SPI3_Init 0 */

  /* USER CODE BEGIN SPI3_Init 1 */

  /* USER CODE END SPI3_Init 1 */
  /* SPI3 parameter configuration*/
  hspi3.Instance = SPI3;
  hspi3.Init.Mode = SPI_MODE_SLAVE;
  hspi3.Init.Direction = SPI_DIRECTION_2LINES;
  hspi3.Init.DataSize = SPI_DATASIZE_8BIT;
  hspi3.Init.CLKPolarity = SPI_POLARITY_LOW;
  hspi3.Init.CLKPhase = SPI_PHASE_1EDGE;
  hspi3.Init.NSS = SPI_NSS_SOFT;
  hspi3.Init.FirstBit = SPI_FIRSTBIT_MSB;
  hspi3.Init.TIMode = SPI_TIMODE_DISABLE;
  hspi3.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;
  hspi3.Init.CRCPolynomial = 0x0;
  hspi3.Init.NSSPMode = SPI_NSS_PULSE_DISABLE;
  hspi3.Init.NSSPolarity = SPI_NSS_POLARITY_LOW;
  hspi3.Init.FifoThreshold = SPI_FIFO_THRESHOLD_01DATA;
  hspi3.Init.TxCRCInitializationPattern = SPI_CRC_INITIALIZATION_ALL_ZERO_PATTERN;
  hspi3.Init.RxCRCInitializationPattern = SPI_CRC_INITIALIZATION_ALL_ZERO_PATTERN;
  hspi3.Init.MasterSSIdleness = SPI_MASTER_SS_IDLENESS_00CYCLE;
  hspi3.Init.MasterInterDataIdleness = SPI_MASTER_INTERDATA_IDLENESS_00CYCLE;
  hspi3.Init.MasterReceiverAutoSusp = SPI_MASTER_RX_AUTOSUSP_DISABLE;
  hspi3.Init.MasterKeepIOState = SPI_MASTER_KEEP_IO_STATE_DISABLE;
  hspi3.Init.IOSwap = SPI_IO_SWAP_DISABLE;
  if (HAL_SPI_Init(&hspi3) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN SPI3_Init 2 */
  /* USER CODE END SPI3_Init 2 */

}


static void MX_TIM1_Init(void)
{

  /* USER CODE BEGIN TIM1_Init 0 */

  /* USER CODE END TIM1_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM1_Init 1 */

  /* USER CODE END TIM1_Init 1 */
  htim1.Instance = TIM1;
  htim1.Init.Prescaler = 239;
  htim1.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim1.Init.Period = 1;
  htim1.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim1.Init.RepetitionCounter = 0;
  htim1.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim1) != HAL_OK)
  {
    Error_Handler();
  }
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim1, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterOutputTrigger2 = TIM_TRGO2_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim1, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM1_Init 2 */

  /* USER CODE END TIM1_Init 2 */

}


static void MX_UART4_Init(void)
{

  /* USER CODE BEGIN UART4_Init 0 */

  /* USER CODE END UART4_Init 0 */

  /* USER CODE BEGIN UART4_Init 1 */

  /* USER CODE END UART4_Init 1 */
  huart4.Instance = UART4;
  huart4.Init.BaudRate = 115200;
  huart4.Init.WordLength = UART_WORDLENGTH_8B;
  huart4.Init.StopBits = UART_STOPBITS_1;
  huart4.Init.Parity = UART_PARITY_NONE;
  huart4.Init.Mode = UART_MODE_TX_RX;
  huart4.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  huart4.Init.OverSampling = UART_OVERSAMPLING_16;
  huart4.Init.OneBitSampling = UART_ONE_BIT_SAMPLE_DISABLE;
  huart4.Init.ClockPrescaler = UART_PRESCALER_DIV1;
  huart4.AdvancedInit.AdvFeatureInit = UART_ADVFEATURE_NO_INIT;
  if (HAL_UART_Init(&huart4) != HAL_OK)
  {
    Error_Handler();
  }
  if (HAL_UARTEx_SetTxFifoThreshold(&huart4, UART_TXFIFO_THRESHOLD_1_8) != HAL_OK)
  {
    Error_Handler();
  }
  if (HAL_UARTEx_SetRxFifoThreshold(&huart4, UART_RXFIFO_THRESHOLD_1_8) != HAL_OK)
  {
    Error_Handler();
  }
  if (HAL_UARTEx_DisableFifoMode(&huart4) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN UART4_Init 2 */

  /* USER CODE END UART4_Init 2 */

}


static void MX_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};
/* USER CODE BEGIN MX_GPIO_Init_1 */
/* USER CODE END MX_GPIO_Init_1 */

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOC_CLK_ENABLE();
  __HAL_RCC_GPIOF_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();
  __HAL_RCC_GPIOG_CLK_ENABLE();
  __HAL_RCC_GPIOD_CLK_ENABLE();
  __HAL_RCC_GPIOE_CLK_ENABLE();

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOF, SB_FP_CTRL_Pin|SB_DR_CTRL_Pin|SB_BP2_CTRL_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(CAN_LED_GPIO_Port, CAN_LED_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOB, GREEN_LED_Pin|RED_LED_Pin|POWER_GOOD_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(SB_BP1_CTRL_GPIO_Port, SB_BP1_CTRL_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(YELLOW_LED_GPIO_Port, YELLOW_LED_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pins : SB_FP_CTRL_Pin SB_DR_CTRL_Pin SB_BP2_CTRL_Pin */
  GPIO_InitStruct.Pin = SB_FP_CTRL_Pin|SB_DR_CTRL_Pin|SB_BP2_CTRL_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_PULLDOWN;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOF, &GPIO_InitStruct);

  /*Configure GPIO pin : CAN_LED_Pin */
  GPIO_InitStruct.Pin = CAN_LED_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(CAN_LED_GPIO_Port, &GPIO_InitStruct);

  /*Configure GPIO pins : GREEN_LED_Pin RED_LED_Pin POWER_GOOD_Pin */
  GPIO_InitStruct.Pin = GREEN_LED_Pin|RED_LED_Pin|POWER_GOOD_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);

  /*Configure GPIO pin : SB_BP1_CTRL_Pin */
  GPIO_InitStruct.Pin = SB_BP1_CTRL_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_PULLDOWN;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(SB_BP1_CTRL_GPIO_Port, &GPIO_InitStruct);

  /*Configure GPIO pins : CH4_Pin CH2_Pin */
  GPIO_InitStruct.Pin = CH4_Pin|CH2_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;
  GPIO_InitStruct.Pull = GPIO_PULLDOWN;
  HAL_GPIO_Init(GPIOD, &GPIO_InitStruct);

  /*Configure GPIO pin : YELLOW_LED_Pin */
  GPIO_InitStruct.Pin = YELLOW_LED_Pin|SB_BP3_CTRL_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOE, &GPIO_InitStruct);

  /* EXTI interrupt init*/
  HAL_NVIC_SetPriority(EXTI1_IRQn, 5, 0);
  HAL_NVIC_EnableIRQ(EXTI1_IRQn);

/* USER CODE BEGIN MX_GPIO_Init_2 */
/* USER CODE END MX_GPIO_Init_2 */
}

/* USER CODE BEGIN 4 */
void UDS_READ_ERRORS(uint8_t status_byte)
{
 uint8_t DIAG_request[4]={0x04,0x19,0x02,status_byte};
 uint8_t print_DTC[3]={0x30,0x00,0x00};
 uint32_t Put_index1,Put_index2;
 uint8_t DIAG_RESPONSE[8]={0,}; 
 uint8_t NEW_MESSAGES_COUNT;
/*------------------------------------------C --------------------------------------------------------*/\
    Put_index1=((FDCAN1->RXF1S)&0x00FF0000)>>16;
    DTOOL_to_AIRBAG.DataLength = FDCAN_DLC_BYTES_4;
    HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,DIAG_request);
    osDelay(UDS_DELAY);/*   */
/*---------------------  DTC-----------------------*/ 
    HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, DIAG_RESPONSE);
    store_CANframeRX(0,DIAG_RESPONSE,RxHeader.DataLength>>16);
/*-------------------    DTC-----------------------------*/
    Put_index1=FDCAN_Get_FIFO_Put_index(FIFO1);
    DTOOL_to_AIRBAG.DataLength = FDCAN_DLC_BYTES_3;
    HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,print_DTC);
    osDelay(UDS_DELAY);/*   */ 
    Put_index2=FDCAN_Get_FIFO_Put_index(FIFO1);
/*------------------  -----------------------------*/
    if(Put_index2>Put_index1)
    {
      NEW_MESSAGES_COUNT=Put_index2-Put_index1;
    }
    else
    {
      NEW_MESSAGES_COUNT=0x40-Put_index1+Put_index2;\
    }
/*-------------------------- -----------------------------------------------*/\
    for(uint8_t i=0;i<NEW_MESSAGES_COUNT;i++)
    {
      HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, DIAG_RESPONSE);
   	  store_CANframeRX(i+1,DIAG_RESPONSE,RxHeader.DataLength>>16);
    }
}
void Accelerometer_reset(void)
{
  CRASH_OCCURED_FLAG=false;
  ctr0=0;
  timeX=-100.5;
  ctr2=0;
  timeY=-100.5;
}
void CLEAR_OUTPUT(void)
{
	memset(Result,  0x00,   sizeof(Result));
	memset(&Output, 0x00, sizeof(Output));
	memset(&Input, 0x00, sizeof(Input));
}
void FDCAN_DISABLE_INTERRUPTS(void)
{
	FDCAN1->ILE ^= FDCAN_ILE_EINT0; //disable fdcan line 0 interrupt
}
void FDCAN_ENABLE_INTERRUPTS(void)
{
	FDCAN1->ILE |= FDCAN_ILE_EINT0; //enable fdcan line 0 interrupt
}
static uint8_t CRC8(uint32_t SPI_data)
{
	uint64_t mask = MAX_UINT64_T - MAX_CRC;
	uint64_t rem = (uint64_t)((((uint64_t)SPI_data) | (((uint64_t)CRC_SEED) << MSG_LEN)) & mask);
	uint64_t divider = ((uint64_t)CRC_POLY) << (MSG_LEN - 1);

	for (uint16_t i = MSG_LEN + CRC_LEN; i > 0; i--) //32 = 4*8
	{
		if (((rem >> (i - 1)) & 0x01) != 0)
		{
			rem ^= divider;
		}
		divider >>= 1;
		if ((rem & mask) == 0) //end of calc
		{
			break;
		}
	}
	// Return 8-bit CRC calculated
	return (uint8_t)(rem & MAX_CRC);
}
static uint32_t form_acc(float acceleration,bool axis)
{
	uint8_t valH0,valL0,valL,valH,B0,B1,B2,B3;
	int16_t acc_val=round(20.47f*acceleration);
	uint32_t formed_acceleration;
	uint8_t RCOMMAND;
	if(acc_val>=0)
	     {
          valL0 = (uint8_t) ((acc_val<<4) & 0x00ff);
          valH0 = (uint8_t) (((acc_val<<4) & 0xff00) >> 8);
          valL=valL0;
          valH=valH0;
	     }
	     else
	     {
          valL0 = (uint8_t) (((-acc_val)<<4) & 0x00ff);
          valH0 = (uint8_t) (((((-acc_val)<<4) & 0xff00) >> 8));
          valL=~valL0+1;
          valH=~valH0;
	     }
  if(axis==X) RCOMMAND=RCOMMAND0x00;
  else RCOMMAND=RCOMMAND0x02;		
  B0=(RCOMMAND|(valH>>6));
  B1=((valH<<2)|(valL>>6));
  B2=(valL<<2);
  B3=CRC8((((uint32_t)B0)<<24)|(((uint32_t)B1)<<16)|(((uint32_t)B2)<<8));
	formed_acceleration=(((uint32_t)B0)<<24)|(((uint32_t)B1)<<16)|(((uint32_t)B2)<<8)|((uint32_t)B3);
	return formed_acceleration;
}

static uint32_t buffer_average_value(uint32_t *buffer_to_evaluate, uint8_t size)
{
	static uint32_t sum;
	uint32_t average;
  for(uint8_t counter=0;counter<size;counter++)
	{
		sum+=buffer_to_evaluate[counter];
	}
	average=sum/size;
	sum=0;
	return average;	
}
static void FDCAN1_Config(void)
{
    
  FDCAN_FilterTypeDef EDR_Filter;
/* Configure FIFO1 Rx filter for EDR messages*/ 
  EDR_Filter.IdType = FDCAN_STANDARD_ID;
  EDR_Filter.FilterIndex = 0;
  EDR_Filter.FilterType = FDCAN_FILTER_RANGE;
  EDR_Filter.FilterConfig = FDCAN_FILTER_TO_RXFIFO1;
  EDR_Filter.FilterID1 = 0x771;
  EDR_Filter.FilterID2 = 0x773;
  HAL_FDCAN_ConfigFilter(&hfdcan1, &EDR_Filter);
  // Configure global filter:
  if (HAL_FDCAN_ConfigGlobalFilter(&hfdcan1, FDCAN_ACCEPT_IN_RX_FIFO0, FDCAN_REJECT, FDCAN_REJECT_REMOTE, FDCAN_REJECT_REMOTE) != HAL_OK)
  {
    Error_Handler();
  }
 
  // Start the FDCAN module 
  if (HAL_FDCAN_Start(&hfdcan1) != HAL_OK)
  {
    Error_Handler();
  }

  if (HAL_FDCAN_ActivateNotification(&hfdcan1, FDCAN_IT_RX_FIFO0_NEW_MESSAGE, 0) != HAL_OK)
  {
    Error_Handler();
  }

  /*Prepare BCM_CANHS_R_04 Tx Header*/ 
  BCM_CANHS_R_04.Identifier = 0x350;
  BCM_CANHS_R_04.IdType = FDCAN_STANDARD_ID;
  BCM_CANHS_R_04.TxFrameType = FDCAN_DATA_FRAME;
  BCM_CANHS_R_04.DataLength = FDCAN_DLC_BYTES_8;
  BCM_CANHS_R_04.ErrorStateIndicator = FDCAN_ESI_ACTIVE;
  BCM_CANHS_R_04.BitRateSwitch = FDCAN_BRS_OFF;
  BCM_CANHS_R_04.FDFormat = FDCAN_CLASSIC_CAN;
  BCM_CANHS_R_04.TxEventFifoControl = FDCAN_NO_TX_EVENTS;
  BCM_CANHS_R_04.MessageMarker = 0;
	
	/*Prepare BRAKE_CANHS_R_01 Tx Header*/
  BRAKE_CANHS_R_01.Identifier = 0x5D7;
  BRAKE_CANHS_R_01.IdType = FDCAN_STANDARD_ID;
  BRAKE_CANHS_R_01.TxFrameType = FDCAN_DATA_FRAME;
  BRAKE_CANHS_R_01.DataLength = FDCAN_DLC_BYTES_8;
  BRAKE_CANHS_R_01.ErrorStateIndicator = FDCAN_ESI_ACTIVE;
  BRAKE_CANHS_R_01.BitRateSwitch = FDCAN_BRS_OFF;
  BRAKE_CANHS_R_01.FDFormat = FDCAN_CLASSIC_CAN;
  BRAKE_CANHS_R_01.TxEventFifoControl = FDCAN_NO_TX_EVENTS;
  BRAKE_CANHS_R_01.MessageMarker = 0;
	
/*Prepare DTOOL_to_AIRBAG Tx Header*/
  DTOOL_to_AIRBAG.Identifier = 0x752;
  DTOOL_to_AIRBAG.IdType = FDCAN_STANDARD_ID;
  DTOOL_to_AIRBAG.TxFrameType = FDCAN_DATA_FRAME;
  DTOOL_to_AIRBAG.DataLength = FDCAN_DLC_BYTES_8;
  DTOOL_to_AIRBAG.ErrorStateIndicator = FDCAN_ESI_ACTIVE;
  DTOOL_to_AIRBAG.BitRateSwitch = FDCAN_BRS_OFF;
  DTOOL_to_AIRBAG.FDFormat = FDCAN_CLASSIC_CAN;
  DTOOL_to_AIRBAG.TxEventFifoControl = FDCAN_NO_TX_EVENTS;
  DTOOL_to_AIRBAG.MessageMarker = 0;
  
	
	/*Prepare CLUSTER_CANHS_RNr_01 Tx Header*/
  CLUSTER_CANHS_RNr_01.Identifier = 0x4F8;
  CLUSTER_CANHS_RNr_01.IdType = FDCAN_STANDARD_ID;
  CLUSTER_CANHS_RNr_01.TxFrameType = FDCAN_DATA_FRAME;
  CLUSTER_CANHS_RNr_01.DataLength = FDCAN_DLC_BYTES_8;
  CLUSTER_CANHS_RNr_01.ErrorStateIndicator = FDCAN_ESI_ACTIVE;
  CLUSTER_CANHS_RNr_01.BitRateSwitch = FDCAN_BRS_OFF;
  CLUSTER_CANHS_RNr_01.FDFormat = FDCAN_CLASSIC_CAN;
  CLUSTER_CANHS_RNr_01.TxEventFifoControl = FDCAN_NO_TX_EVENTS;
  CLUSTER_CANHS_RNr_01.MessageMarker = 0;
  FDCAN_DISABLE_INTERRUPTS();
}

unsigned long SeedToKey(unsigned long seed,unsigned char rnd)
 {
  unsigned int i;
  unsigned long key=seed;
  if(rnd<(255-35)) rnd+=35;
  else rnd=255;
  for(i=1;i<=rnd; i++)
  { if((key&0x80000000)!=0) key=(key<<1)^Mask03;
  else key<<=1; }
  return key;
 }
void EnterSecurityAccess(void)//    frame 0-5  Output
{
    uint8_t Put_index1=0;
    uint8_t ECU_response[8];
    uint8_t ExtendedSession[3]={0x02,0x10,0x02};
    uint8_t Request_seed[4]={0x03,0x27,0x01,0x00};
    uint8_t Enter_key[7]={0x06,0x27,0x02,0,0,0,0};
    uint32_t seed,key;
    DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_3;
    HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,ExtendedSession);
    store_CANframeTX(0,ExtendedSession,sizeof(ExtendedSession),DTOOL_to_AIRBAG.Identifier);
    Put_index1=FDCAN_Get_FIFO_Put_index(FIFO1);
    while(_NO_RX_FIFO1_NEW_MESSAGE)
    {
      __NOP();
    }
    HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, ECU_response);
    store_CANframeRX(1,ECU_response,sizeof(ECU_response));
    DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_4;
    HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,Request_seed);
    store_CANframeTX(2,Request_seed,sizeof(Request_seed),DTOOL_to_AIRBAG.Identifier);
    Put_index1=FDCAN_Get_FIFO_Put_index(FIFO1);
    while(_NO_RX_FIFO1_NEW_MESSAGE)
    {
      __NOP();
    }
    HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, ECU_response);
    store_CANframeRX(3,ECU_response,sizeof(ECU_response));
    seed=(ECU_response[3]<<24)+(ECU_response[4]<<16)+(ECU_response[5]<<8)+(ECU_response[6]);
    key=SeedToKey(seed,0);
    for(uint8_t i=0;i<4;i++)
    {
     Enter_key[i+3]=(uint8_t)(key>>8*(3-i));
    }
    DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_7;
    HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,Enter_key);
    store_CANframeTX(4,Enter_key,sizeof(Enter_key),DTOOL_to_AIRBAG.Identifier);
    Put_index1=FDCAN_Get_FIFO_Put_index(FIFO1);
    while(_NO_RX_FIFO1_NEW_MESSAGE)
    {
      __NOP();
    }
    HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, ECU_response);
    store_CANframeRX(5,ECU_response,sizeof(ECU_response));
}
void store_CANframeRX(uint8_t framenum,uint8_t* data, size_t length)
{
   CanFrame ReceivedFrame;
   ReceivedFrame.timestamp=RxHeader.RxTimestamp;
   ReceivedFrame.id=RxHeader.Identifier;				
   ReceivedFrame.length=(RxHeader.DataLength)>>16;
   ReceivedFrame.data.size=ReceivedFrame.length;
   memcpy(ReceivedFrame.data.bytes,data,length);  
   Output.frame[framenum]=ReceivedFrame;
   Output.frame_count++;
}
void store_CANframeTX(uint8_t framenum,uint8_t* data, size_t length,uint16_t ID)
{
   CanFrame TxFrame;
   TxFrame.id=DTOOL_to_AIRBAG.Identifier;				
   TxFrame.length=(DTOOL_to_AIRBAG.DataLength)>>16;
   TxFrame.data.size=TxFrame.length;
   memcpy(TxFrame.data.bytes,data,length);
   Output.frame[framenum]=TxFrame;
   Output.frame_count++;
}
void Send_Result(void)
{
    uint8_t len[2];
    uint16_t message_length;
    Output.method=Method_GET;
	pb_ostream_t streamwrt = pb_ostream_from_buffer(Result, sizeof(Result));
    pb_encode(&streamwrt, TestData_fields, &Output);
    message_length=streamwrt.bytes_written;
	len[0]=((message_length)>>8)&0xFF;
    len[1]=(message_length)&0xFF;
	HAL_UART_Transmit(&huart4,len,2,1000);
    HAL_UART_Transmit(&huart4,Result,message_length,1000);
	CLEAR_OUTPUT();
}
uint8_t FDCAN_Get_FIFO_Put_index(bool FIFOnbr)
{
    uint8_t Put_index;
    if(FIFOnbr==FIFO0){Put_index=((FDCAN1->RXF0S)&0x00FF0000)>>16;}
    else              {Put_index=((FDCAN1->RXF1S)&0x00FF0000)>>16;}
    return Put_index;    
}
void Send_Request(uint8_t Request_to_send)
{
    uint8_t ECU_reset[5]={0x02,0x11,0x01};
    uint8_t Clear_Diagnostic_information[5]={0x04,0x14,0xFF,0xFF,0xFF};
    uint8_t ExtendedDiagnostic[3]={0x02, 0x10, 0x02};
    uint8_t* Request;
    uint8_t Put_index1;
    uint8_t UDS_response[8];
    if(Request_to_send==ECU_RESET)
    {
        Request=ECU_reset;
        DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_3;
    }
    else if(Request_to_send==ENTER_EXTENDED_DIAGNOSTIC)
    {
        Request=ExtendedDiagnostic;
        DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_3;
    }
    else if(Request_to_send==CLEAR_DIAGNOSTIC_INFORMATION)
    {
        Request=Clear_Diagnostic_information;
        DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_5;
    }
    HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,Request);
    store_CANframeTX(0,Request, DTOOL_to_AIRBAG.DataLength>>16,DTOOL_to_AIRBAG.Identifier);
    Put_index1=FDCAN_Get_FIFO_Put_index(FIFO1);
    while(_NO_RX_FIFO1_NEW_MESSAGE){__NOP();}
    HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, UDS_response);
    store_CANframeRX(1,UDS_response, RxHeader.DataLength>>16);    
}
void Write_VIN(bool VIN_to_WRITE)//0-VIN=0,1-VIN!=0
{
  uint8_t VIN_RESET_1[8]={0x10,0x11,0x2E,0xF1,0x90,0x00,0x00,0x00};
  uint8_t VIN_RESET_2[8]={0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  uint8_t DIAG_RESPONSE[8]={0,};
  uint32_t Put_index1;
  if(VIN_to_WRITE==1)
  {
   VIN_RESET_1[3]=0xAA;
   VIN_RESET_1[4]=0xAA;      
  }
  DTOOL_to_AIRBAG.DataLength=FDCAN_DLC_BYTES_8;
  HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,VIN_RESET_1);
  store_CANframeTX(0,VIN_RESET_1, 8,DTOOL_to_AIRBAG.Identifier);
  Put_index1=FDCAN_Get_FIFO_Put_index(FIFO1);
  while(_NO_RX_FIFO1_NEW_MESSAGE)
  {
	__NOP();
  }
  HAL_FDCAN_GetRxMessage(&hfdcan1, FDCAN_RX_FIFO1, &RxHeader, DIAG_RESPONSE);
  store_CANframeRX(1,DIAG_RESPONSE, RxHeader.DataLength>>16);  
  HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,VIN_RESET_2);
  store_CANframeTX(0,VIN_RESET_2, 8,DTOOL_to_AIRBAG.Identifier);
  VIN_RESET_2[0]+=0x01;
  osDelay(10);
  HAL_FDCAN_AddMessageToTxFifoQ(&hfdcan1,&DTOOL_to_AIRBAG,VIN_RESET_2);
  store_CANframeTX(0,VIN_RESET_2, 8,DTOOL_to_AIRBAG.Identifier);
  osDelay(10);
}


/* USER CODE END 4 */
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
  /* USER CODE BEGIN Callback 0 */
  if(htim->Instance == TIM1) //check if the interrupt comes from TIM1
  {
	time++; 
  }
  /* USER CODE END Callback 0 */
  if (htim->Instance == TIM13) {
    HAL_IncTick();
  }
  /* USER CODE BEGIN Callback 1 */

  /* USER CODE END Callback 1 */
}

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */
